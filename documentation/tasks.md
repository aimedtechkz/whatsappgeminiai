# üìã –ü–õ–ê–ù –ó–ê–î–ê–ß –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–ê: WhatsApp AI Agent System

## üéØ –û –¥–æ–∫—É–º–µ–Ω—Ç–µ

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å–∏—Å—Ç–µ–º—ã WhatsApp AI Agent  
**–î–ª—è –∫–æ–≥–æ**: Backend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ Python  
**–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: 4 –Ω–µ–¥–µ–ª–∏  
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: 2 –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞ + –æ—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

---

## üìä WEEK 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –±–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### **–î–µ–Ω—å 1-2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö**

#### –ó–∞–¥–∞—á–∞ 1.1: –°–æ–∑–¥–∞—Ç—å PostgreSQL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ Render.com
- –°–æ–∑–¥–∞—Ç—å –¥–≤–µ PostgreSQL –±–∞–∑—ã:
  - `whatsapp_gateway` - –¥–ª—è –ü–†–û–ï–ö–¢ 1
  - `ai_agent` - –¥–ª—è –ü–†–û–ï–ö–¢ 2
- –ó–∞–ø–∏—Å–∞—Ç—å connection strings –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –æ–±–µ–∏–º –ë–î —á–µ—Ä–µ–∑ psql –∏–ª–∏ DBeaver

#### –ó–∞–¥–∞—á–∞ 1.2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å RabbitMQ/Redis
- –í—ã–±—Ä–∞—Ç—å —Å–µ—Ä–≤–∏—Å –æ—á–µ—Ä–µ–¥–µ–π: RabbitMQ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) –∏–ª–∏ Redis
- –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å RabbitMQ –Ω–∞ CloudAMQP (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω) –∏–ª–∏ Redis –Ω–∞ Render
- –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∏ –æ—á–µ—Ä–µ–¥–∏:
  - `incoming_messages` (TTL: 24 —á–∞—Å–∞, max length: 10000)
  - `outgoing_messages` (TTL: 1 —á–∞—Å, max length: 5000)
  - `voice_transcription` (TTL: 2 —á–∞—Å–∞, max length: 1000)
- –ó–∞–ø–∏—Å–∞—Ç—å URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ RabbitMQ Management UI

#### –ó–∞–¥–∞—á–∞ 1.3: –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á–∏
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ Wappi.pro
- –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (Token)
- –ü–æ–ª—É—á–∏—Ç—å profile_id –∏–∑ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
- –ó–∞–ø–∏—Å–∞—Ç—å –Ω–æ–º–µ—Ä WhatsApp: +77752837306
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API —á–µ—Ä–µ–∑ Postman (–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ Google AI Studio
- –ü–æ–ª—É—á–∏—Ç—å Gemini API –∫–ª—é—á
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å –∫ Gemini 2.5 Pro —á–µ—Ä–µ–∑ curl –∏–ª–∏ Postman

---

### **–î–µ–Ω—å 3-4: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ ORM –º–æ–¥–µ–ª–∏**

#### –ó–∞–¥–∞—á–∞ 1.4: –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ü–†–û–ï–ö–¢ 1 (WhatsApp Gateway)
- –°–æ–∑–¥–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π Git: `whatsapp-gateway`
- –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫:
  - `config/` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
  - `services/` - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
  - `models/` - ORM –º–æ–¥–µ–ª–∏
  - `api/` - REST endpoints
  - `utils/` - —É—Ç–∏–ª–∏—Ç—ã
  - `tests/` - —Ç–µ—Å—Ç—ã
- –°–æ–∑–¥–∞—Ç—å `requirements.txt` —Å–æ –≤—Å–µ–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- –°–æ–∑–¥–∞—Ç—å `.env.example` —Å —à–∞–±–ª–æ–Ω–æ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –°–æ–∑–¥–∞—Ç—å `.gitignore` (–∏—Å–∫–ª—é—á–∏—Ç—å .env, __pycache__, logs/)
- –°–æ–∑–¥–∞—Ç—å `README.md` —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –ø–æ –∑–∞–ø—É—Å–∫—É

#### –ó–∞–¥–∞—á–∞ 1.5: –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ü–†–û–ï–ö–¢ 2 (AI Agent)
- –°–æ–∑–¥–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π Git: `ai-agent-service`
- –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫:
  - `config/` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
  - `services/` - AI —Å–µ—Ä–≤–∏—Å—ã
  - `models/` - ORM –º–æ–¥–µ–ª–∏
  - `api/` - REST endpoints
  - `prompts/` - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø—Ä–æ–º–ø—Ç—ã
  - `knowledge_base/` - PDF —Ñ–∞–π–ª—ã
  - `utils/` - —É—Ç–∏–ª–∏—Ç—ã
  - `tests/` - —Ç–µ—Å—Ç—ã
- –°–æ–∑–¥–∞—Ç—å `requirements.txt` —Å–æ –≤—Å–µ–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- –°–æ–∑–¥–∞—Ç—å `.env.example`
- –°–æ–∑–¥–∞—Ç—å `.gitignore`
- –°–æ–∑–¥–∞—Ç—å `README.md`

#### –ó–∞–¥–∞—á–∞ 1.6: –°–æ–∑–¥–∞—Ç—å ORM –º–æ–¥–µ–ª–∏ –¥–ª—è –ü–†–û–ï–ö–¢ 1
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SQLAlchemy –∏ psycopg2-binary
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `config/database.py`:
  - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
  - –°–æ–∑–¥–∞—Ç—å Base –¥–ª—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
  - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å session factory
- –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å `models/message_log.py`:
  - –ü–æ–ª—è: id, message_id, phone_number, direction, message_text, is_voice, wappi_status, queue_status, created_at, processed_at
  - –ò–Ω–¥–µ–∫—Å—ã: –ø–æ phone_number –∏ created_at
- –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å `models/whitelist.py`:
  - –ü–æ–ª—è: id, phone_number, note, added_at
  - Unique constraint –Ω–∞ phone_number
- –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü
- –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∫ –ë–î
- –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–∏—Ç—å whitelist —Ç—Ä–µ–º—è –Ω–æ–º–µ—Ä–∞–º–∏: +77752837306, +77018855588, +77088098009

#### –ó–∞–¥–∞—á–∞ 1.7: –°–æ–∑–¥–∞—Ç—å ORM –º–æ–¥–µ–ª–∏ –¥–ª—è –ü–†–û–ï–ö–¢ 2
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SQLAlchemy –∏ psycopg2-binary
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `config/database.py` —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –ë–î
- –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å `models/contact.py`:
  - –ü–æ–ª—è: id, phone_number, name, full_name, business_name, is_client, classification_confidence, classification_reasoning, last_message_at, created_at, updated_at
  - –ò–Ω–¥–µ–∫—Å—ã: –ø–æ phone_number –∏ is_client
  - Unique constraint –Ω–∞ phone_number
- –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å `models/message.py`:
  - –ü–æ–ª—è: id, contact_id (FK), phone_number, message_id, message_text, is_from_bot, is_voice, voice_transcription, timestamp
  - –ò–Ω–¥–µ–∫—Å—ã: –ø–æ contact_id –∏ timestamp (DESC)
  - Cascade delete –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞
- –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å `models/follow_up.py`:
  - –ü–æ–ª—è: id, contact_id (FK), touch_number (1-5), next_touch_at, last_touch_at, is_completed, stop_reason, created_at
  - Check constraint: touch_number BETWEEN 1 AND 5
  - –ò–Ω–¥–µ–∫—Å: –ø–æ next_touch_at –≥–¥–µ is_completed = FALSE
- –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å `models/scheduled_call.py`:
  - –ü–æ–ª—è: id, contact_id (FK), scheduled_at, timezone, status, notes, created_at
  - –ò–Ω–¥–µ–∫—Å: –ø–æ scheduled_at
- –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –ë–î

---

### **–î–µ–Ω—å 5-7: –ë–∞–∑–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**

#### –ó–∞–¥–∞—á–∞ 1.8: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –æ–±–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
- –í –ü–†–û–ï–ö–¢ 1 —Å–æ–∑–¥–∞—Ç—å `config/settings.py`:
  - –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ python-dotenv
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (WAPPI_TOKEN, RABBITMQ_URL, DATABASE_URL)
  - –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã: POLLING_INTERVAL=5, TIMEZONE='Asia/Almaty'
- –í –ü–†–û–ï–ö–¢ 2 —Å–æ–∑–¥–∞—Ç—å `config/settings.py`:
  - –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
  - –í–∞–ª–∏–¥–∞—Ü–∏—è GEMINI_API_KEY, RABBITMQ_URL, DATABASE_URL
  - –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã: MAX_CONTEXT_MESSAGES=20, WORKING_HOURS_START=10, WORKING_HOURS_END=18
  - –ü–∞—Ä—Å–∏–Ω–≥ FOLLOW_UP_INTERVALS="24,72,168,336,720" –≤ —Å–ø–∏—Å–æ–∫ —á–∏—Å–µ–ª

#### –ó–∞–¥–∞—á–∞ 1.9: –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å —Ä–∞–±–æ—Ç—ã —Å –æ—á–µ—Ä–µ–¥—è–º–∏ –¥–ª—è –ü–†–û–ï–ö–¢ 1
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `config/queue.py`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å QueueManager:
  - –ú–µ—Ç–æ–¥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ RabbitMQ/Redis
  - –ú–µ—Ç–æ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å (–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏–º—è –æ—á–µ—Ä–µ–¥–∏ –∏ dict —Å–æ–æ–±—â–µ–Ω–∏—è)
  - –ú–µ—Ç–æ–¥ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –æ—á–µ—Ä–µ–¥—å (callback —Ñ—É–Ω–∫—Ü–∏—è)
  - –ú–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ—á–µ—Ä–µ–¥–∏
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
- –°–æ–∑–¥–∞—Ç—å singleton –∏–Ω—Å—Ç–∞–Ω—Å –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –î–æ–±–∞–≤–∏—Ç—å graceful shutdown –ø—Ä–∏ SIGTERM/SIGINT

#### –ó–∞–¥–∞—á–∞ 1.10: –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å —Ä–∞–±–æ—Ç—ã —Å –æ—á–µ—Ä–µ–¥—è–º–∏ –¥–ª—è –ü–†–û–ï–ö–¢ 2
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `config/queue.py` (–∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π –ü–†–û–ï–ö–¢ 1)
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å QueueManager —Å —Ç–µ–º–∏ –∂–µ –º–µ—Ç–æ–¥–∞–º–∏
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å prefetch_count=1 –¥–ª—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –æ—á–µ—Ä–µ–¥—å—é

#### –ó–∞–¥–∞—á–∞ 1.11: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –í –æ–±–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö —Å–æ–∑–¥–∞—Ç—å `utils/logger.py`
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å loguru:
  - –í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å —Å —Ü–≤–µ—Ç–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
  - –ó–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª `logs/app_{date}.log` —Å —Ä–æ—Ç–∞—Ü–∏–µ–π (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å)
  - –•—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤ 30 –¥–Ω–µ–π
  - –£—Ä–æ–≤–Ω–∏: DEBUG –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, INFO –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- –°–æ–∑–¥–∞—Ç—å helper —Ñ—É–Ω–∫—Ü–∏–∏:
  - `log_incoming_message(message_data)`
  - `log_outgoing_message(message_data)`
  - `log_error(service_name, error, context)`
  - `log_queue_operation(operation, queue_name, data)`

#### –ó–∞–¥–∞—á–∞ 1.12: –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å timezone
- –í –ü–†–û–ï–ö–¢ 2 —Å–æ–∑–¥–∞—Ç—å `utils/timezone_helper.py`
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É pytz
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏:
  - `get_current_time_astana()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ timezone Asia/Almaty
  - `is_working_hours(datetime_obj)` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –≤—Ä–µ–º—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 10:00-18:00
  - `get_next_working_time(datetime_obj)` - –µ—Å–ª–∏ –≤—Ä–µ–º—è –≤–Ω–µ —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–µ–¥—É—é—â–µ–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ (10:00 —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è)
  - `is_working_day(datetime_obj)` - –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —ç—Ç–æ –Ω–µ –≤—ã—Ö–æ–¥–Ω–æ–π (–ü–Ω-–ü—Ç)
  - `format_datetime_for_user(datetime_obj)` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç—É: "15 –æ–∫—Ç—è–±—Ä—è –≤ 14:30"

---

## üìä WEEK 2: –ü–†–û–ï–ö–¢ 1 - WhatsApp Gateway Service

### **–î–µ–Ω—å 8-9: Wappi API –∫–ª–∏–µ–Ω—Ç**

#### –ó–∞–¥–∞—á–∞ 2.1: –°–æ–∑–¥–∞—Ç—å Wappi API client wrapper
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `services/wappi_client.py`
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É requests
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å WappiClient —Å –º–µ—Ç–æ–¥–∞–º–∏:
  - `__init__()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å —Ç–æ–∫–µ–Ω–æ–º –∏ profile_id –∏–∑ settings
  - `get_chats(limit=100, offset=0, show_all=False)` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤
  - `send_message(recipient, body)` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—ã—á–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
  - `reply_to_message(message_id, body)` - –æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  - `mark_as_read(message_id, mark_all=False)` - –æ—Ç–º–µ—Ç–∫–∞ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º
  - `get_message_file(message_id)` - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ (–¥–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö)
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞:
  - –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É HTTP –æ—à–∏–±–æ–∫ (400, 401, 429, 500)
  - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã
  - –î–æ–±–∞–≤–∏—Ç—å retry –º–µ—Ö–∞–Ω–∏–∑–º (3 –ø–æ–ø—ã—Ç–∫–∏ —Å exponential backoff)
  - –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥ `_make_request(method, endpoint, params, data)` –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏
- –î–æ–±–∞–≤–∏—Ç—å timeout –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (30 —Å–µ–∫—É–Ω–¥)

#### –ó–∞–¥–∞—á–∞ 2.2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Wappi –∫–ª–∏–µ–Ω—Ç–∞
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `tests/test_wappi.py`
- –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã:
  - –¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è (mock responses)
  - –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ 429 –æ—à–∏–±–∫–∏ (rate limit)
  - –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ 500 –æ—à–∏–±–∫–∏ —Å retry
  - –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–ø—É—Å—Ç–æ–π recipient)
- –ù–∞–ø–∏—Å–∞—Ç—å integration —Ç–µ—Å—Ç:
  - –†–µ–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Å–≤–æ–π –Ω–æ–º–µ—Ä
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —á–∞—Ç–æ–≤
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–º–µ—Ç–∫–∏ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–≥–æ
- –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç

---

### **–î–µ–Ω—å 10-11: Polling Service**

#### –ó–∞–¥–∞—á–∞ 2.3: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Message Polling Service
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `services/polling_service.py`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å MessagePollingService:
  - `__init__()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WappiClient, QueueManager, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
  - `start_polling()` - –æ—Å–Ω–æ–≤–Ω–æ–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ü–∏–∫–ª
  - `process_chats()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —á–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ WappiClient
  - `extract_new_messages(dialog)` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –¥–∏–∞–ª–æ–≥–∞
  - `is_in_whitelist(phone_number)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–º–µ—Ä–∞ –≤ whitelist –∏–∑ –ë–î
  - `publish_to_queue(message_data)` - –ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –æ—á–µ—Ä–µ–¥—å incoming_messages
- –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:
  - –ö–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ –≤—ã–∑—ã–≤–∞—Ç—å get_chats(limit=100)
  - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞ –≤ –æ—Ç–≤–µ—Ç–µ:
    - –ò–∑–≤–ª–µ—á—å phone_number –∏–∑ chat_id (—É–±—Ä–∞—Ç—å "@c.us")
    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å whitelist - –µ—Å–ª–∏ –Ω–æ–º–µ—Ä –≤ —Å–ø–∏—Å–∫–µ, –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
    - –ò–∑–≤–ª–µ—á—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–Ω—Ç–∞–∫—Ç–µ (FirstName, FullName, BusinessName)
    - –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –¥–∏–∞–ª–æ–≥–∞
    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–æ—Å—å –ª–∏ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ (–ø—Ä–æ–≤–µ—Ä–∫–∞ message_id –≤ message_logs)
    - –ï—Å–ª–∏ –Ω–æ–≤–æ–µ - —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å dict —Å –¥–∞–Ω–Ω—ã–º–∏
    - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ message_logs —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'queued'
    - –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å incoming_messages
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:
  - –û–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è (is_voice = true –µ—Å–ª–∏ –µ—Å—Ç—å audio)
  - –î–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å voice_transcription
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
  - –ü—Ä–∏ –æ—à–∏–±–∫–µ API –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É, –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å polling
  - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
  - –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –æ—á–µ—Ä–µ–¥—å—é - –ø—ã—Ç–∞—Ç—å—Å—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è

#### –ó–∞–¥–∞—á–∞ 2.4: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–∞–ø—É—Å–∫ polling –∫–∞–∫ —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É asyncio
- –°–æ–∑–¥–∞—Ç—å –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª `app.py` –¥–ª—è –ü–†–û–ï–ö–¢ 1:
  - –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å MessagePollingService
  - –°–æ–∑–¥–∞—Ç—å async main() —Ñ—É–Ω–∫—Ü–∏—é
  - –ó–∞–ø—É—Å—Ç–∏—Ç—å polling_service.start_polling() –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º —Ü–∏–∫–ª–µ
  - –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É SIGTERM –¥–ª—è graceful shutdown
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ:
  - –ó–∞–ø—É—Å—Ç–∏—Ç—å app.py
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —á–∞—Ç—ã –ø–æ–ª—É—á–∞—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ø–∞–¥–∞—é—Ç –≤ –æ—á–µ—Ä–µ–¥—å
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

---

### **–î–µ–Ω—å 12-13: Sender Service**

#### –ó–∞–¥–∞—á–∞ 2.5: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Message Sender Service
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `services/sender_service.py`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å MessageSenderService:
  - `__init__()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WappiClient, QueueManager, –ë–î
  - `start_consuming()` - –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ—á–µ—Ä–µ–¥—å outgoing_messages
  - `process_outgoing_message(message_data)` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
  - `send_via_wappi(phone, text, reply_to_id)` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Wappi
  - `mark_message_as_sent(message_id)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ –ë–î
- –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:
  - –ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –æ—á–µ—Ä–µ–¥–∏ outgoing_messages
  - –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ: phone_number, message_text, reply_to_message_id (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  - –ï—Å–ª–∏ –µ—Å—Ç—å reply_to_message_id - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å reply_to_message(), –∏–Ω–∞—á–µ send_message()
  - –ï—Å–ª–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ —Ñ–ª–∞–≥ mark_as_read=true - –≤—ã–∑–≤–∞—Ç—å mark_as_read()
  - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ message_logs —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'sent' –∏ direction='outgoing'
  - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏ (ack)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
  - –ü—Ä–∏ –Ω–µ—É–¥–∞—á–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ - –ø–æ–≤—Ç–æ—Ä–∏—Ç—å 3 —Ä–∞–∑–∞
  - –ü–æ—Å–ª–µ 3 –Ω–µ—É–¥–∞—á - –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ dead-letter queue –∏–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å
  - –ù–µ –ª–æ–º–∞—Ç—å –≤–µ—Å—å —Å–µ—Ä–≤–∏—Å –ø—Ä–∏ –æ—à–∏–±–∫–µ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- –î–æ–±–∞–≤–∏—Ç—å throttling:
  - –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –±–æ–ª–µ–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Wappi)
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sleep –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏

#### –ó–∞–¥–∞—á–∞ 2.6: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Sender –≤ app.py
- –û–±–Ω–æ–≤–∏—Ç—å `app.py` –ü–†–û–ï–ö–¢ 1:
  - –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å MessageSenderService
  - –ó–∞–ø—É—Å—Ç–∏—Ç—å sender_service.start_consuming() –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å polling
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å asyncio.gather() –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å end-to-end:
  - –í—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å outgoing_messages
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–æ—Å—å –≤ WhatsApp
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∏ –ë–î –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å—Ç–∞—Ç—É—Å–æ–≤

---

### **–î–µ–Ω—å 14: Voice Transcription Service**

#### –ó–∞–¥–∞—á–∞ 2.7: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Voice Transcription Service
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `services/voice_service.py`
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Gemini: google-genai
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å VoiceTranscriptionService:
  - `__init__()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WappiClient, Gemini client, QueueManager
  - `start_consuming()` - –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ—á–µ—Ä–µ–¥—å voice_transcription
  - `process_voice_message(message_data)` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ
  - `download_audio(message_id)` - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ Wappi API
  - `transcribe_with_gemini(audio_bytes)` - —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è —á–µ—Ä–µ–∑ Gemini
  - `publish_transcription(original_data, transcription)` - –ø—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞—Ç–Ω–æ –≤ incoming_messages
- –õ–æ–≥–∏–∫–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏:
  - –ü–æ–ª—É—á–∏—Ç—å message_data –∏–∑ –æ—á–µ—Ä–µ–¥–∏ voice_transcription
  - –°–∫–∞—á–∞—Ç—å –∞—É–¥–∏–æ —Ñ–∞–π–ª —á–µ—Ä–µ–∑ wappi_client.get_message_file()
  - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ base64 –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Gemini 2.5 Pro —Å –ø—Ä–æ–º–ø—Ç–æ–º: "–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–π —ç—Ç–æ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ:"
  - –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
  - –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º "[–¢–†–ê–ù–°–ö–†–ò–ë–ê–¶–ò–Ø]"
  - –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å incoming_messages —Å —Ñ–ª–∞–≥–æ–º is_voice=true
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
  - –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å - –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
  - –ï—Å–ª–∏ Gemini –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É - –ø–æ–≤—Ç–æ—Ä–∏—Ç—å 2 —Ä–∞–∑–∞
  - –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å –≤ –ë–î
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:
  - –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –∞—É–¥–∏–æ —Ñ–∞–π–ª—ã –≤—Ä–µ–º–µ–Ω–Ω–æ (—É–¥–∞–ª—è—Ç—å –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏)
  - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

#### –ó–∞–¥–∞—á–∞ 2.8: –î–æ–±–∞–≤–∏—Ç—å Voice Service –≤ app.py
- –û–±–Ω–æ–≤–∏—Ç—å `app.py`:
  - –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å VoiceTranscriptionService
  - –î–æ–±–∞–≤–∏—Ç—å –≤ asyncio.gather() —Ç—Ä–µ—Ç–∏–π —Å–µ—Ä–≤–∏—Å
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ –Ω–æ–º–µ—Ä –±–æ—Ç–∞
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –æ–Ω–æ –ø–æ–ø–∞–ª–æ –≤ –æ—á–µ—Ä–µ–¥—å voice_transcription
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –ø–æ—è–≤–∏–ª–∞—Å—å –≤ incoming_messages
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ—á–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

---

### **–î–µ–Ω—å 14: Health Check API**

#### –ó–∞–¥–∞—á–∞ 2.9: –°–æ–∑–¥–∞—Ç—å Health Check endpoints
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å FastAPI –∏ uvicorn
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `api/health.py`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å endpoints:
  - `GET /health` - —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞ (healthy/unhealthy)
    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ RabbitMQ
    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Wappi API (ping)
    - –í–µ—Ä–Ω—É—Ç—å –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ polling
  - `GET /stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
    - –ü–æ—Å—á–∏—Ç–∞—Ç—å messages_received_today –∏–∑ message_logs
    - –ü–æ—Å—á–∏—Ç–∞—Ç—å messages_sent_today
    - –ü–æ—Å—á–∏—Ç–∞—Ç—å voice_transcribed_today
    - –ü–æ–ª—É—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä –∫–∞–∂–¥–æ–π –æ—á–µ—Ä–µ–¥–∏
- –î–æ–±–∞–≤–∏—Ç—å CORS middleware –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞
- –ó–∞–ø—É—Å—Ç–∏—Ç—å FastAPI –Ω–∞ –ø–æ—Ä—Ç—É 8000 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

#### –ó–∞–¥–∞—á–∞ 2.10: –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ü–†–û–ï–ö–¢ 1
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ:
  - Polling –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
  - Voice —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É—é—Ç—Å—è
  - –°–æ–æ–±—â–µ–Ω–∏—è –∏–∑ outgoing –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
  - Whitelist –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç
- –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å 50 —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–¥—Ä—è–¥
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∏—Å—å
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ warning/error
- –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –±–∞–≥–∏

---

## üìä WEEK 3: –ü–†–û–ï–ö–¢ 2 - AI Agent Service

### **–î–µ–Ω—å 15-16: Gemini Client –∏ Knowledge Base**

#### –ó–∞–¥–∞—á–∞ 3.1: –°–æ–∑–¥–∞—Ç—å Gemini API client wrapper
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `services/gemini_client.py`
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å google-genai
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å GeminiClient:
  - `__init__()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å API –∫–ª—é—á–æ–º –∏–∑ settings
  - `generate_response(system_prompt, conversation_history, temperature=0.7)` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
  - `classify_json(prompt, temperature=0.1)` - –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Å JSON response
  - `transcribe_audio(audio_bytes, mime_type)` - —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è (–¥–ª—è Voice Service)
- –î–ª—è –º–µ—Ç–æ–¥–∞ generate_response:
  - –ü—Ä–∏–Ω–∏–º–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å —Ä–æ–ª—è–º–∏: [{"role": "user", "parts": [{"text": "..."}]}]
  - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å GenerateContentConfig —Å system_instruction
  - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—Ç–≤–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç
  - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- –î–ª—è –º–µ—Ç–æ–¥–∞ classify_json:
  - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å response_mime_type="application/json"
  - –ü–∞—Ä—Å–∏—Ç—å JSON –æ—Ç–≤–µ—Ç
  - –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É (–¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å isClient, confidence, reasoning)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
  - Rate limit (429) - –∂–¥–∞—Ç—å –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å
  - Quota exceeded - –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å critical error
  - Invalid API key - –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å–µ—Ä–≤–∏—Å–∞
- –î–æ–±–∞–≤–∏—Ç—å retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤

#### –ó–∞–¥–∞—á–∞ 3.2: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Knowledge Base Loader
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `services/knowledge_loader.py`
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PyPDF2 –∏ pdfplumber
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å KnowledgeBaseLoader:
  - `__init__()` - —É–∫–∞–∑–∞—Ç—å –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ knowledge_base/
  - `load_all_pdfs()` - –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö PDF —Ñ–∞–π–ª–æ–≤ –∏–∑ –ø–∞–ø–∫–∏
  - `extract_text_from_pdf(file_path)` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ PDF
  - `index_content()` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
  - `search_knowledge(query)` - –ø–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
  - `get_full_knowledge()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞
- –õ–æ–≥–∏–∫–∞ extract_text:
  - –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å pdfplumber —Å–Ω–∞—á–∞–ª–∞ (–ª—É—á—à–µ –¥–ª—è —Ç–∞–±–ª–∏—Ü)
  - –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PyPDF2
  - –û—á–∏—Å—Ç–∏—Ç—å —Ç–µ–∫—Å—Ç –æ—Ç –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤
  - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É (–∑–∞–≥–æ–ª–æ–≤–∫–∏, –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã)
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:
  - –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ PDF –≤ –ø–∞–º—è—Ç–∏ –∏–ª–∏ Redis
  - –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–∏—Å–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ PDF –æ–¥–∏–Ω —Ä–∞–∑
  - –û–±–Ω–æ–≤–ª—è—Ç—å –∫—ç—à —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤

#### –ó–∞–¥–∞—á–∞ 3.3: –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `prompts/moderator_prompt.txt`:
  - –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞ –∏–∑ –¢–ó
  - –î–æ–±–∞–≤–∏—Ç—å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã: {contact_name}, {full_name}, {business_name}, {conversation_history}
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å JSON —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ –ø—Ä–∏–º–µ—Ä–µ
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `prompts/sales_agent_prompt.txt`:
  - –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞ –∏–∑ –¢–ó
  - –î–æ–±–∞–≤–∏—Ç—å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã: {knowledge_base}, {conversation_history}, {new_message}, {current_datetime}
  - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ª–æ–≥–∏–∫–∞ –°–ü–ò–ù-–ø—Ä–æ–¥–∞–∂ –ø–æ–Ω—è—Ç–Ω–æ –æ–ø–∏—Å–∞–Ω–∞
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `prompts/follow_up_prompt.txt`:
  - –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞ –∏–∑ –¢–ó
  - –î–æ–±–∞–≤–∏—Ç—å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã: {touch_number}, {conversation_history}, {last_bot_message}, {last_client_message}, {follow_up_reason}, {hours_since_last_message}, {current_datetime}
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞—Å–∞–Ω–∏—è (1-5)

#### –ó–∞–¥–∞—á–∞ 3.4: –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å PDF –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `knowledge_base/`
- –ü–æ–º–µ—Å—Ç–∏—Ç—å —Ç—É–¥–∞ PDF —Ñ–∞–π–ª—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–æ–¥—É–∫—Ç–µ (–ø–æ–ª—É—á–∏—Ç—å –æ—Ç –∑–∞–∫–∞–∑—á–∏–∫–∞)
- –ï—Å–ª–∏ —Ñ–∞–π–ª–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç - —Å–æ–∑–¥–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π product_info.pdf —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
  - –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞/—É—Å–ª—É–≥–∏
  - –û–ø–∏—Å–∞–Ω–∏–µ
  - –¶–µ–Ω—ã
  - –£—Å–ª–æ–≤–∏—è
  - –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
  - FAQ
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É:
  - –ó–∞–ø—É—Å—Ç–∏—Ç—å knowledge_loader.load_all_pdfs()
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç–µ–∫—Å—Ç –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∏—Ä–∏–ª–ª–∏—Ü—É (—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫)

---

### **–î–µ–Ω—å 17-18: Message Consumer –∏ AI Moderator**

#### –ó–∞–¥–∞—á–∞ 3.5: –°–æ–∑–¥–∞—Ç—å Message Consumer Service
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `services/message_consumer.py`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å MessageConsumerService:
  - `__init__()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è QueueManager, –ë–î, AI Moderator, AI Sales Agent
  - `start_consuming()` - –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ—á–µ—Ä–µ–¥—å incoming_messages
  - `process_incoming_message(message_data)` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
  - `get_or_create_contact(phone, contact_info)` - –ø–æ–ª—É—á–µ–Ω–∏–µ/—Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –≤ –ë–î
  - `save_message(contact_id, message_data)` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ë–î
  - `route_to_handler(contact, message)` - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ is_client
- –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:
  - –ü–æ–ª—É—á–∏—Ç—å message –∏–∑ –æ—á–µ—Ä–µ–¥–∏
  - –ò–∑–≤–ª–µ—á—å phone_number –∏ contact_info
  - –ù–∞–π—Ç–∏ –∫–æ–Ω—Ç–∞–∫—Ç –≤ –ë–î –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π (is_client=NULL)
  - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü—É messages
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å is_client –∫–æ–Ω—Ç–∞–∫—Ç–∞:
    - NULL ‚Üí –ø–µ—Ä–µ–¥–∞—Ç—å –≤ AI Moderator –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
    - FALSE ‚Üí –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å (–Ω–µ –æ—Ç–≤–µ—á–∞—Ç—å)
    - TRUE ‚Üí –ø–µ—Ä–µ–¥–∞—Ç—å –≤ AI Sales Agent –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞
  - –û–±–Ω–æ–≤–∏—Ç—å last_message_at —É –∫–æ–Ω—Ç–∞–∫—Ç–∞
  - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ –æ—á–µ—Ä–µ–¥–∏ (ack)

#### –ó–∞–¥–∞—á–∞ 3.6: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å AI Moderator Service
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `services/ai_moderator.py`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å AIModeratorService:
  - `__init__()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è GeminiClient, –ë–î
  - `classify_contact(contact_id)` - –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
  - `get_conversation_history(contact_id, limit=20)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 20 —Å–æ–æ–±—â–µ–Ω–∏–π
  - `format_conversation_for_prompt(messages)` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Å—Ç—Ä–æ–∫—É
  - `parse_classification_result(json_result)` - –ø–∞—Ä—Å–∏–Ω–≥ JSON –æ—Ç Gemini
  - `save_classification(contact_id, is_client, confidence, reasoning)` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
- –õ–æ–≥–∏–∫–∞ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏:
  - –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–º–ø—Ç –∏–∑ prompts/moderator_prompt.txt
  - –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π –∫–æ–Ω—Ç–∞–∫—Ç–∞ –∏–∑ –ë–î
  - –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–Ω—Ç–∞–∫—Ç–µ (name, full_name, business_name)
  - –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –≤ –ø—Ä–æ–º–ø—Ç–µ:
    - {contact_name} ‚Üí contact.name
    - {full_name} ‚Üí contact.full_name
    - {business_name} ‚Üí contact.business_name
    - {conversation_history} ‚Üí –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç –≤ Gemini —á–µ—Ä–µ–∑ classify_json()
  - –†–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON –æ—Ç–≤–µ—Ç
  - –ò–∑–≤–ª–µ—á—å: isClient (true/false/null), confidence (0.0-1.0), reasoning (—Å—Ç—Ä–æ–∫–∞)
  - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ç–∞–±–ª–∏—Ü—É contacts
  - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ —Å reasoning –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞:
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ isClient –∏–º–µ–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (true/false/null)
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ confidence –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0-1
  - –ï—Å–ª–∏ JSON –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π - –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –≤–µ—Ä–Ω—É—Ç—å null

#### –ó–∞–¥–∞—á–∞ 3.7: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Moderator –≤ Consumer
- –û–±–Ω–æ–≤–∏—Ç—å `message_consumer.py`:
  - –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å is_client –∫–æ–Ω—Ç–∞–∫—Ç–∞
  - –ï—Å–ª–∏ is_client = NULL –∏ —Å–æ–æ–±—â–µ–Ω–∏–π >= 3:
    - –í—ã–∑–≤–∞—Ç—å moderator.classify_contact(contact_id)
    - –ü–æ–ª—É—á–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ is_client
    - –ï—Å–ª–∏ —Ç–µ–ø–µ—Ä—å TRUE - –ø–µ—Ä–µ–¥–∞—Ç—å –≤ Sales Agent
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
  - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç —Å 3 —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (–∫–ª–∏–µ–Ω—Ç/–Ω–µ –∫–ª–∏–µ–Ω—Ç/–Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ)

---

### **–î–µ–Ω—å 19-20: AI Sales Agent**

#### –ó–∞–¥–∞—á–∞ 3.8: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å AI Sales Agent Service
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `services/ai_sales_agent.py`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å AISalesAgentService:
  - `__init__()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è GeminiClient, KnowledgeBaseLoader, QueueManager, –ë–î
  - `generate_response(contact_id, new_message)` - –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
  - `get_conversation_context(contact_id, limit=20)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
  - `format_context_for_gemini(messages)` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É Gemini
  - `check_for_call_scheduling(response_text, contact)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è —Å–æ–∑–≤–æ–Ω–∞
  - `schedule_call(contact_id, datetime_str)` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ scheduled_calls
  - `publish_response(phone_number, response_text, reply_to_id)` - –ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤ outgoing
- –õ–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞:
  - –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–º–ø—Ç –∏–∑ prompts/sales_agent_prompt.txt
  - –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π –∫–æ–Ω—Ç–∞–∫—Ç–∞
  - –ó–∞–≥—Ä—É–∑–∏—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π —á–µ—Ä–µ–∑ knowledge_loader.get_full_knowledge()
  - –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É/–≤—Ä–µ–º—è –≤ –ê—Å—Ç–∞–Ω–µ
  - –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã:
    - {knowledge_base} ‚Üí –ø–æ–ª–Ω–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
    - {conversation_history} ‚Üí –∏—Å—Ç–æ—Ä–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ Gemini
    - {new_message} ‚Üí —Ç–µ–∫—Å—Ç –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    - {current_datetime} ‚Üí "5 –æ–∫—Ç—è–±—Ä—è 2025, 14:30 (–≤—Ä–µ–º—è –ê—Å—Ç–∞–Ω—ã)"
  - –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å conversation history –¥–ª—è Gemini:
    - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç [{"role": "user/model", "parts": [{"text": "..."}]}]
  - –í—ã–∑–≤–∞—Ç—å gemini_client.generate_response() —Å system_prompt –∏ –∏—Å—Ç–æ—Ä–∏–µ–π
  - –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
  - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç –≤ messages —Å is_from_bot=True
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å–æ–∑–≤–æ–Ω–∞ –≤ –æ—Ç–≤–µ—Ç–µ
  - –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å outgoing_messages
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–∑–≤–æ–Ω–æ–≤:
  - –ü–∞—Ä—Å–∏—Ç—å —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∫–ª—é—á–µ–≤—ã–µ —Ñ—Ä–∞–∑—ã: "–∑–∞–ø–∏—Å–∞–ª –Ω–∞", "—Å–æ–∑–≤–æ–Ω–∏–º—Å—è", "–ø–æ–∑–≤–æ–Ω–∏–º"
  - –ò–∑–≤–ª–µ—á—å –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è —É–ø–æ–º–∏–Ω–∞–µ–º–æ–≥–æ —Å–æ–∑–≤–æ–Ω–∞
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ timezone_helper.is_working_hours()
  - –ï—Å–ª–∏ –≤—Ä–µ–º—è —Ä–∞–±–æ—á–µ–µ - —Å–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ scheduled_calls
  - –ï—Å–ª–∏ –≤—Ä–µ–º—è –Ω–µ—Ä–∞–±–æ—á–µ–µ - —ç—Ç–æ –æ—à–∏–±–∫–∞ –ø—Ä–æ–º–ø—Ç–∞ (–Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å)

#### –ó–∞–¥–∞—á–∞ 3.9: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Sales Agent –≤ Consumer
- –û–±–Ω–æ–≤–∏—Ç—å `message_consumer.py`:
  - –í –º–µ—Ç–æ–¥–µ route_to_handler() –¥–ª—è is_client=TRUE:
    - –í—ã–∑–≤–∞—Ç—å sales_agent.generate_response(contact, message)
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
  - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç —Å is_client=TRUE
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ "–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –≤–∞—à –ø—Ä–æ–¥—É–∫—Ç?"
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –æ—Ç–≤–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª—Å—è
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –æ—Ç–≤–µ—Ç –ø–æ–ø–∞–ª –≤ –æ—á–µ—Ä–µ–¥—å outgoing_messages
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –æ—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª—Å—è —á–µ—Ä–µ–∑ –ü–†–û–ï–ö–¢ 1
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤:
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å 10 —Ä–∞–∑–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
  - –û—Ü–µ–Ω–∏—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è (—ç–º–æ–¥–∑–∏, –¥–ª–∏–Ω–∞)

#### –ó–∞–¥–∞—á–∞ 3.10: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–≤–æ–Ω–æ–≤
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ "–•–æ—á—É —Å–æ–∑–≤–æ–Ω–∏—Ç—å—Å—è"
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç –±–æ—Ç–∞ (–¥–æ–ª–∂–µ–Ω —Å–ø—Ä–æ—Å–∏—Ç—å —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è)
- –û—Ç–≤–µ—Ç–∏—Ç—å "–ó–∞–≤—Ç—Ä–∞ –≤ 15:00"
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
  - –ë–æ—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª —Å–æ–∑–≤–æ–Ω
  - –ó–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–ª–∞—Å—å –≤ scheduled_calls
  - –í—Ä–µ–º—è –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã (10-18)
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è:
  - –û—Ç–≤–µ—Ç–∏—Ç—å "–ó–∞–≤—Ç—Ä–∞ –≤ 20:00"
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±–æ—Ç –ø—Ä–µ–¥–ª–æ–∂–∏–ª –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –≤—Ä–µ–º—è

---

### **–î–µ–Ω—å 21: Follow-up Scheduler**

#### –ó–∞–¥–∞—á–∞ 3.11: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Follow-up Scheduler Service
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `services/follow_up_scheduler.py`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å FollowUpSchedulerService:
  - `__init__()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è GeminiClient, QueueManager, –ë–î, timezone helper
  - `start_scheduler()` - –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –ø—Ä–æ–≤–µ—Ä–∫–∏
  - `check_contacts_for_followup()` - –ø–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –Ω—É–∂–¥–∞—é—â–∏—Ö—Å—è –≤ follow-up
  - `should_start_followup(contact)` - –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω—É–∂–µ–Ω –ª–∏ follow-up
  - `analyze_last_response(message_text)` - –∞–Ω–∞–ª–∏–∑ –æ—Ç–≤–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞ (–î–ê/–ù–ï–¢/–Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ)
  - `create_followup_chain(contact_id)` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏ –∫–∞—Å–∞–Ω–∏–π
  - `generate_followup_message(contact_id, touch_number)` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
  - `send_followup(contact_id, message_text)` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å
- –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è follow-up:
  - –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã –≥–¥–µ:
    - is_client = TRUE
    - –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –±–æ—Ç–∞ (is_from_bot=True)
    - –° –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–æ—à–ª–æ >= 24 —á–∞—Å–∞
    - –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏ follow-up (is_completed=False)
  - –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
  - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —Ç–æ—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã:
    - –î–ê: ["–¥–∞", "—Å–æ–≥–ª–∞—Å–µ–Ω", "–≥–æ—Ç–æ–≤", "–¥–∞–≤–∞–π—Ç–µ", "—Ö–æ—Ä–æ—à–æ", "–æ–∫"]
    - –ù–ï–¢: ["–Ω–µ—Ç", "–Ω–µ –Ω–∞–¥–æ", "–Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ", "–Ω–µ —Å–µ–π—á–∞—Å", "–æ—Ç–∫–∞–∂—É—Å—å"]
    - –ò–≥–Ω–æ—Ä: –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –≤–æ–æ–±—â–µ –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª
    - –ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ: ["–ø–æ—Å–º–æ—Ç—Ä—é", "–ø–æ–¥—É–º–∞—é", "–º–æ–∂–µ—Ç –±—ã—Ç—å", "–≤–æ–∑–º–æ–∂–Ω–æ"]
  - –ï—Å–ª–∏ –î–ê –∏–ª–∏ –ù–ï–¢ - –ù–ï –∑–∞–ø—É—Å–∫–∞—Ç—å follow-up
  - –ï—Å–ª–∏ –ò–≥–Ω–æ—Ä –∏–ª–∏ –ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ - –∑–∞–ø—É—Å—Ç–∏—Ç—å follow-up
- –°–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏:
  - –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ follow_ups —Å touch_number=1
  - –†–∞—Å—Å—á–∏—Ç–∞—Ç—å next_touch_at = —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è + 24 —á–∞—Å–∞
  - is_completed = False
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è:
  - –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–º–ø—Ç –∏–∑ prompts/follow_up_prompt.txt
  - –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–µ—Ä–µ–ø–∏—Å–∫–∏
  - –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç–∞
  - –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
  - –†–∞—Å—Å—á–∏—Ç–∞—Ç—å hours_since_last_message
  - –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã
  - –í—ã–∑–≤–∞—Ç—å gemini_client.generate_response()
  - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ messages
  - –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤ outgoing_messages

#### –ó–∞–¥–∞—á–∞ 3.12: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –∫–∞—Å–∞–Ω–∏–π
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `process_touch(follow_up_record)`:
  - –ü–æ–ª—É—á–∏—Ç—å –∑–∞–ø–∏—Å—å –∏–∑ follow_ups –≥–¥–µ next_touch_at <= NOW –∏ is_completed=False
  - –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ touch_number
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å
  - –û–±–Ω–æ–≤–∏—Ç—å last_touch_at
  - –ï—Å–ª–∏ touch_number < 5:
    - –£–≤–µ–ª–∏—á–∏—Ç—å touch_number –Ω–∞ 1
    - –†–∞—Å—Å—á–∏—Ç–∞—Ç—å next_touch_at –ø–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º: [24, 72, 168, 336, 720] —á–∞—Å–æ–≤
  - –ï—Å–ª–∏ touch_number = 5:
    - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å is_completed = True
    - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å stop_reason = 'completed_5_touches'
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `stop_followup(contact_id, reason)`:
  - –ù–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É—é —Ü–µ–ø–æ—á–∫—É follow-up
  - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å is_completed = True
  - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å stop_reason = reason ('client_responded', 'client_said_yes', 'client_said_no')
- –û–±–Ω–æ–≤–∏—Ç—å message_consumer.py:
  - –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞:
    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω—ã–π follow-up
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞
    - –ï—Å–ª–∏ –î–ê –∏–ª–∏ –ù–ï–¢ - –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å follow-up
    - –ï—Å–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ - –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å follow-up

#### –ó–∞–¥–∞—á–∞ 3.13: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Scheduler –≤ app.py
- –°–æ–∑–¥–∞—Ç—å –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª `app.py` –¥–ª—è –ü–†–û–ï–ö–¢ 2:
  - –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å MessageConsumerService –∏ FollowUpSchedulerService
  - –°–æ–∑–¥–∞—Ç—å async main():
    - –ó–∞–ø—É—Å—Ç–∏—Ç—å consumer.start_consuming()
    - –ó–∞–ø—É—Å—Ç–∏—Ç—å scheduler.start_scheduler()
    - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å asyncio.gather()
  - –î–æ–±–∞–≤–∏—Ç—å graceful shutdown
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
  - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç
  - –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
  - –ö–ª–∏–µ–Ω—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç 24 —á–∞—Å–∞
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–∏—à–ª–æ –∫–∞—Å–∞–Ω–∏–µ #1
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏ –æ—Ç–≤–µ—Ç–µ

---

## üìä WEEK 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –¥–µ–ø–ª–æ–π

### **–î–µ–Ω—å 22-23: End-to-end —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

#### –ó–∞–¥–∞—á–∞ 4.1: –°–∫–≤–æ–∑–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
- –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:
  - –ù–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç –ø–∏—à–µ—Ç –ø–µ—Ä–≤—ã–π —Ä–∞–∑
  - –ö–æ–Ω—Ç–∞–∫—Ç –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç
  - –ö–æ–Ω—Ç–∞–∫—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç –æ—Ç sales agent
  - –ö–æ–Ω—Ç–∞–∫—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç 24 —á–∞—Å–∞
  - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è follow-up
  - –ö–æ–Ω—Ç–∞–∫—Ç –æ—Ç–≤–µ—á–∞–µ—Ç "–î–∞"
  - Follow-up –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
  - –ù–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è —Å–æ–∑–≤–æ–Ω
- –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∂–¥—ã–π —à–∞–≥:
  - –õ–æ–≥–∏ –æ–±–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
  - –ó–∞–ø–∏—Å–∏ –≤ –ë–î
  - –°–æ–æ–±—â–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—è—Ö
  - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ WhatsApp
- –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
- –ó–∞–ø–∏—Å–∞—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –±–∞–≥–∏

#### –ó–∞–¥–∞—á–∞ 4.2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ edge cases
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏:
  - –ö–æ–Ω—Ç–∞–∫—Ç –≤ whitelist (–¥–æ–ª–∂–µ–Ω –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è)
  - –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (—Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è + –æ–±—Ä–∞–±–æ—Ç–∫–∞)
  - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–¥—Ä—è–¥ (5+ –∑–∞ –º–∏–Ω—É—Ç—É)
  - –û—á–µ–Ω—å –¥–ª–∏–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (1000+ —Å–∏–º–≤–æ–ª–æ–≤)
  - –°–æ–æ–±—â–µ–Ω–∏–µ —Å —ç–º–æ–¥–∑–∏ –∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–∞–º–∏
  - –ö–æ–Ω—Ç–∞–∫—Ç –ø–∏—à–µ—Ç –≤ 23:00 (–≤–Ω–µ —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤)
  - Gemini API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏)
  - RabbitMQ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (recovery)
  - PostgreSQL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (recovery)
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª—É—á–∞—è:
  - –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ
  - –£–±–µ–¥–∏—Ç—å—Å—è –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ
  - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### –ó–∞–¥–∞—á–∞ 4.3: –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤—ã—Å–æ–∫—É—é –Ω–∞–≥—Ä—É–∑–∫—É:
  - 100 —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –ø–∏—à—É—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
  - 50 –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ 5 –º–∏–Ω—É—Ç
  - 200 follow-up –∫–∞—Å–∞–Ω–∏–π –≤ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç
- –ò–∑–º–µ—Ä–∏—Ç—å:
  - –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
  - –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
  - –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ CPU
  - –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–µ–π
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:
  - –°–µ—Ä–≤–∏—Å—ã –Ω–µ –ø–∞–¥–∞—é—Ç
  - –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
  - –û—á–µ—Ä–µ–¥–∏ –Ω–µ –ø–µ—Ä–µ–ø–æ–ª–Ω—è—é—Ç—Å—è
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É–∑–∫–∏–µ –º–µ—Å—Ç–∞

---

### **–î–µ–Ω—å 24: –§–∏–Ω–∞–ª—å–Ω–∞—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤**

#### –ó–∞–¥–∞—á–∞ 4.4: –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞
- –°–æ–±—Ä–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–π
- –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–æ—á–Ω—ã–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –û–±–Ω–æ–≤–∏—Ç—å moderator_prompt.txt:
  - –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
  - –£—Ç–æ—á–Ω–∏—Ç—å edge cases
  - –î–æ–±–∞–≤–∏—Ç—å few-shot –ø—Ä–∏–º–µ—Ä—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 50 —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö
- –ó–∞–º–µ—Ä–∏—Ç—å —Ç–æ—á–Ω–æ—Å—Ç—å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ò—Ç–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è 90%+ —Ç–æ—á–Ω–æ—Å—Ç–∏

#### –ó–∞–¥–∞—á–∞ 4.5: –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ sales agent
- –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤ –±–æ—Ç–∞
- –°–æ–±—Ä–∞—Ç—å feedback –æ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–æ–≤
- –û–±–Ω–æ–≤–∏—Ç—å sales_agent_prompt.txt:
  - –°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è
  - –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏–∫—É –°–ü–ò–ù-–ø—Ä–æ–¥–∞–∂
  - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã —Ö–æ—Ä–æ—à–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤
  - –£—Ç–æ—á–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Å–æ–∑–≤–æ–Ω–æ–≤
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 30 —Ä–∞–∑–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–∞—Ö
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –±—Ä–µ–Ω–¥—É

#### –ó–∞–¥–∞—á–∞ 4.6: –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ follow-up
- –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–∞—Å–∞–Ω–∏–π
- –û–±–Ω–æ–≤–∏—Ç—å follow_up_prompt.txt:
  - –£–ª—É—á—à–∏—Ç—å —Ç–µ–∫—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞—Å–∞–Ω–∏—è
  - –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ 5 –∫–∞—Å–∞–Ω–∏–π
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–∞–∂–¥–æ–µ –∫–∞—Å–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ

---

### **–î–µ–Ω—å 25-26: –î–µ–ø–ª–æ–π –Ω–∞ Render.com**

#### –ó–∞–¥–∞—á–∞ 4.7: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ü–†–û–ï–ö–¢ 1 –∫ –¥–µ–ø–ª–æ—é
- –°–æ–∑–¥–∞—Ç—å Dockerfile –¥–ª—è whatsapp-gateway:
  - –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ python:3.11-slim
  - –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ requirements.txt –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
  - –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞
  - CMD –¥–ª—è –∑–∞–ø—É—Å–∫–∞ app.py
- –°–æ–∑–¥–∞—Ç—å render.yaml:
  - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å web service
  - –£–∫–∞–∑–∞—Ç—å healthCheckPath: /health
  - –î–æ–±–∞–≤–∏—Ç—å environment variables
  - –ü–æ–¥–∫–ª—é—á–∏—Ç—å PostgreSQL database
  - –ü–æ–¥–∫–ª—é—á–∏—Ç—å Redis/RabbitMQ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ Docker:
  - docker build -t whatsapp-gateway .
  - docker run —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
  - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –°–æ–∑–¥–∞—Ç—å .dockerignore:
  - –ò—Å–∫–ª—é—á–∏—Ç—å .env, __pycache__, logs/, tests/

#### –ó–∞–¥–∞—á–∞ 4.8: –î–µ–ø–ª–æ–π –ü–†–û–ï–ö–¢ 1 –Ω–∞ Render
- –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π Web Service –Ω–∞ Render.com
- –ü–æ–¥–∫–ª—é—á–∏—Ç—å Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π whatsapp-gateway
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å environment variables:
  - WAPPI_TOKEN
  - WAPPI_PROFILE_ID
  - RABBITMQ_URL (–∏–ª–∏ Redis URL)
  - DATABASE_URL
  - –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏–∑ .env
- –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–≤—ã–π deploy
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health endpoint
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å polling (–¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫)

#### –ó–∞–¥–∞—á–∞ 4.9: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ü–†–û–ï–ö–¢ 2 –∫ –¥–µ–ø–ª–æ—é
- –°–æ–∑–¥–∞—Ç—å Dockerfile –¥–ª—è ai-agent-service:
  - –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ python:3.11-slim
  - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è PDF (poppler-utils)
  - –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ requirements.txt
  - –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞
  - –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ prompts/ –∏ knowledge_base/
  - CMD –¥–ª—è –∑–∞–ø—É—Å–∫–∞ app.py
- –°–æ–∑–¥–∞—Ç—å render.yaml –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ü–†–û–ï–ö–¢ 1
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ Docker
- –°–æ–∑–¥–∞—Ç—å .dockerignore

#### –ó–∞–¥–∞—á–∞ 4.10: –î–µ–ø–ª–æ–π –ü–†–û–ï–ö–¢ 2 –Ω–∞ Render
- –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π Web Service –Ω–∞ Render.com
- –ü–æ–¥–∫–ª—é—á–∏—Ç—å Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ai-agent-service
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å environment variables:
  - GEMINI_API_KEY
  - RABBITMQ_URL
  - DATABASE_URL
  - –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ .env
- –ó–∞–≥—Ä—É–∑–∏—Ç—å PDF —Ñ–∞–π–ª—ã –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- –ó–∞–ø—É—Å—Ç–∏—Ç—å deploy
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health endpoint
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å consumer (–ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ—á–µ—Ä–µ–¥—å)

#### –ó–∞–¥–∞—á–∞ 4.11: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–î –Ω–∞ Render
- –°–æ–∑–¥–∞—Ç—å –¥–≤–µ PostgreSQL –±–∞–∑—ã –Ω–∞ Render:
  - whatsapp-gateway-db
  - ai-agent-service-db
- –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∫ –æ–±–µ–∏–º –ë–î:
  - –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ psql
  - –í—ã–ø–æ–ª–Ω–∏—Ç—å CREATE TABLE —Å–∫—Ä–∏–ø—Ç—ã
  - –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã
  - –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–∏—Ç—å whitelist
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ —Å–µ—Ä–≤–∏—Å–æ–≤
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup (daily)

#### –ó–∞–¥–∞—á–∞ 4.12: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—á–µ—Ä–µ–¥–µ–π
- –°–æ–∑–¥–∞—Ç—å RabbitMQ –∏–Ω—Å—Ç–∞–Ω—Å –Ω–∞ CloudAMQP (–∏–ª–∏ Redis –Ω–∞ Render)
- –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∏ –æ—á–µ—Ä–µ–¥–∏ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∏–∑ –¢–ó
- –û–±–Ω–æ–≤–∏—Ç—å RABBITMQ_URL –≤ –æ–±–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é –∏ –ø–æ–¥–ø–∏—Å–∫—É

---

### **–î–µ–Ω—å 27: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

#### –ó–∞–¥–∞—á–∞ 4.13: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –í—ã–±—Ä–∞—Ç—å —Å–µ—Ä–≤–∏—Å –¥–ª—è –ª–æ–≥–æ–≤ (–æ–ø—Ü–∏–∏: Papertrail, Logtail, Render Logs)
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –ª–æ–≥–æ–≤ –∏–∑ –æ–±–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
- –°–æ–∑–¥–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π:
  - ERROR - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
  - WARNING - –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
  - INFO - –æ–±—ã—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã:
  - Email –ø—Ä–∏ ERROR –ª–æ–≥–∞—Ö
  - Email –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞
  - Email –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –∫–≤–æ—Ç—ã Gemini

#### –ó–∞–¥–∞—á–∞ 4.14: –°–æ–∑–¥–∞—Ç—å –¥–∞—à–±–æ—Ä–¥ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ Render –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å
- –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏:
  - CPU usage –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
  - Memory usage
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
  - –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–µ–π
  - –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ health endpoints
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–æ–≤:
  - CPU > 80%
  - Memory > 90%
  - Queue size > 1000
  - Health check failed

#### –ó–∞–¥–∞—á–∞ 4.15: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –°–æ–∑–¥–∞—Ç—å runbook –≤ README:
  - –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –ü–†–û–ï–ö–¢ 1
  - –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –ü–†–û–ï–ö–¢ 2
  - –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ—á–µ—Ä–µ–¥–µ–π
  - –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –∏—Å—á–µ—Ä–ø–∞–Ω–∏–∏ –∫–≤–æ—Ç—ã Gemini
  - –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π —Å–≤—è–∑–∏
- –°–æ–∑–¥–∞—Ç—å —á–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã:
  - Health endpoints –æ—Ç–≤–µ—á–∞—é—Ç 200 OK
  - Polling —Ä–∞–±–æ—Ç–∞–µ—Ç (–ª–æ–≥–∏ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫)
  - –°–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î)
  - –û—á–µ—Ä–µ–¥–∏ –Ω–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω—ã
  - –ù–µ—Ç ERROR –≤ –ª–æ–≥–∞—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å

---

### **–î–µ–Ω—å 28: –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**

#### –ó–∞–¥–∞—á–∞ 4.16: –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- –í—ã–ø–æ–ª–Ω–∏—Ç—å end-to-end —Ç–µ—Å—Ç –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –æ–∫—Ä—É–∂–µ–Ω–∏–∏:
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Å—å —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –æ—Ç–≤–µ—Ç–∞
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–≤–æ–Ω –∏ follow-up
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏–∑ –ó–∞–¥–∞—á–∏ 4.2
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –±–∞–≥–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

#### –ó–∞–¥–∞—á–∞ 4.17: –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°–æ–∑–¥–∞—Ç—å USER_GUIDE.md:
  - –ö–∞–∫ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (–æ–±—â–∞—è —Å—Ö–µ–º–∞)
  - –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –ø–∏—à–µ—Ç
  - –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
  - –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç follow-up
  - –ö–∞–∫ –Ω–∞–∑–Ω–∞—á–∞—é—Ç—Å—è —Å–æ–∑–≤–æ–Ω—ã
  - Whitelist –Ω–æ–º–µ—Ä–æ–≤
- –°–æ–∑–¥–∞—Ç—å FAQ:
  - –ü–æ—á–µ–º—É –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ?
  - –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä –≤ whitelist?
  - –ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π?
  - –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã?
  - –ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É?

#### –ó–∞–¥–∞—á–∞ 4.18: –°–æ–∑–¥–∞—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- –°–æ–∑–¥–∞—Ç—å ARCHITECTURE.md:
  - –î–∏–∞–≥—Ä–∞–º–º–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
  - –û–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
  - –°—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥–∏
  - –°—Ö–µ–º–∞ –ë–î —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Ç–∞–±–ª–∏—Ü
- –°–æ–∑–¥–∞—Ç—å DEPLOYMENT.md:
  - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é –Ω–∞ Render
  - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
  - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
  - Rollback –ø—Ä–æ—Ü–µ–¥—É—Ä–∞
- –°–æ–∑–¥–∞—Ç—å API_REFERENCE.md:
  - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤—Å–µ—Ö endpoints
  - –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
  - –ö–æ–¥—ã –æ—à–∏–±–æ–∫

#### –ó–∞–¥–∞—á–∞ 4.19: Code review –∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
- –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–µ–≤—å—é –∫–æ–¥–∞ –æ–±–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤:
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ PEP 8
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ docstrings
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
  - –£–¥–∞–ª–∏—Ç—å –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥
  - –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
  - –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–¥–µ –Ω—É–∂–Ω–æ
  - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã
  - –î–æ–±–∞–≤–∏—Ç—å connection pooling –¥–ª—è –ë–î
- –£–ª—É—á—à–∏—Ç—å —á–∏—Ç–∞–µ–º–æ—Å—Ç—å:
  - –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
  - –†–∞–∑–±–∏—Ç—å –±–æ–ª—å—à–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
  - –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–µ

#### –ó–∞–¥–∞—á–∞ 4.20: –ü–µ—Ä–µ–¥–∞—á–∞ –ø—Ä–æ–µ–∫—Ç–∞
- –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∫ –ø–µ—Ä–µ–¥–∞—á–µ:
  - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ .env –Ω–µ –≤ Git
  - –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
  - README –ø–æ–ª–Ω—ã–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π
- –°–æ–∑–¥–∞—Ç—å –≤–∏–¥–µ–æ-–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é (10-15 –º–∏–Ω—É—Ç):
  - –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã
  - –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
  - –ü–æ–∫–∞–∑ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
  - –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –¥–∞—à–±–æ—Ä–¥–∞
- –ü—Ä–æ–≤–µ—Å—Ç–∏ handover —Å–µ—Å—Å–∏—é:
  - –ü—Ä–æ–π—Ç–∏—Å—å –ø–æ –∫–æ–¥—É
  - –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã
  - –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞–∫ –º–µ–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  - –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞–∫ –æ–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–æ–º–ø—Ç—ã
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø—ã:
  - GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
  - Render.com –ø—Ä–æ–µ–∫—Ç—ã
  - RabbitMQ/Redis
  - PostgreSQL –±–∞–∑—ã
  - Gemini API key (–∏–ª–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Å–≤–æ–π)

---

## üìã –ß–ï–ö–õ–ò–°–¢ –ì–û–¢–û–í–ù–û–°–¢–ò –ö –ó–ê–ü–£–°–ö–£

### **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
- [ ] PostgreSQL –¥–ª—è –ü–†–û–ï–ö–¢ 1 —Å–æ–∑–¥–∞–Ω–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–∞
- [ ] PostgreSQL –¥–ª—è –ü–†–û–ï–ö–¢ 2 —Å–æ–∑–¥–∞–Ω–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–∞
- [ ] RabbitMQ/Redis –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] –í—Å–µ —Ç—Ä–∏ –æ—á–µ—Ä–µ–¥–∏ —Å–æ–∑–¥–∞–Ω—ã
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∫ –æ–±–µ–∏–º –ë–î
- [ ] Whitelist –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω —Ç—Ä–µ–º—è –Ω–æ–º–µ—Ä–∞–º–∏
- [ ] –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã

### **–ü–†–û–ï–ö–¢ 1: WhatsApp Gateway**
- [ ] Wappi API —Ç–æ–∫–µ–Ω –∏ profile_id –≤–∞–ª–∏–¥–Ω—ã
- [ ] WappiClient —Ä–∞–±–æ—Ç–∞–µ—Ç (—Ç–µ—Å—Ç–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —É—Å–ø–µ—à–Ω–∞)
- [ ] Polling Service –∑–∞–ø—É—â–µ–Ω –∏ –ø–æ–ª—É—á–∞–µ—Ç —á–∞—Ç—ã –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫
- [ ] Sender Service –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ outgoing_messages
- [ ] Voice Transcription Service –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ voice_transcription
- [ ] Health endpoint –æ—Ç–≤–µ—á–∞–µ—Ç 200 OK
- [ ] –õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –°–µ—Ä–≤–∏—Å –∑–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ Render

### **–ü–†–û–ï–ö–¢ 2: AI Agent Service**
- [ ] Gemini API –∫–ª—é—á –≤–∞–ª–∏–¥–µ–Ω
- [ ] GeminiClient —Ä–∞–±–æ—Ç–∞–µ—Ç (—Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω)
- [ ] PDF –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –ø–∞—Ä—Å—è—Ç—Å—è
- [ ] –í—Å–µ —Ç—Ä–∏ –ø—Ä–æ–º–ø—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] Message Consumer –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ incoming_messages
- [ ] AI Moderator –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] AI Sales Agent –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞–¥–µ–∫–≤–∞—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- [ ] Follow-up Scheduler —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- [ ] Timezone helper –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã
- [ ] Health endpoint –æ—Ç–≤–µ—á–∞–µ—Ç 200 OK
- [ ] –°–µ—Ä–≤–∏—Å –∑–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ Render

### **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
- [ ] –°–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –≤—Å—é —Ü–µ–ø–æ—á–∫—É (–ü–†–û–ï–ö–¢ 1 ‚Üí –û—á–µ—Ä–µ–¥—å ‚Üí –ü–†–û–ï–ö–¢ 2 ‚Üí –û—á–µ—Ä–µ–¥—å ‚Üí –ü–†–û–ï–ö–¢ 1 ‚Üí WhatsApp)
- [ ] –ì–æ–ª–æ—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É—é—Ç—Å—è –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
- [ ] Whitelist —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –Ω–æ–º–µ—Ä–∞
- [ ] –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [ ] –û—Ç–≤–µ—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ WhatsApp
- [ ] Follow-up –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –°–æ–∑–≤–æ–Ω—ã –Ω–∞–∑–Ω–∞—á–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [ ] –ê–ª–µ—Ä—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –î–∞—à–±–æ—Ä–¥ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Runbook —Å–æ–∑–¥–∞–Ω

### **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
- [ ] README –≤ –æ–±–æ–∏—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö
- [ ] USER_GUIDE.md —Å–æ–∑–¥–∞–Ω
- [ ] ARCHITECTURE.md —Å–æ–∑–¥–∞–Ω
- [ ] DEPLOYMENT.md —Å–æ–∑–¥–∞–Ω
- [ ] API_REFERENCE.md —Å–æ–∑–¥–∞–Ω
- [ ] –í–∏–¥–µ–æ-–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –∑–∞–ø–∏—Å–∞–Ω–∞

---

## üéØ –ö–†–ò–¢–ï–†–ò–ò –ü–†–ò–ï–ú–ö–ò –ü–†–û–ï–ö–¢–ê

### **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è**
1. ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ WhatsApp —á–µ—Ä–µ–∑ Wappi API
2. ‚úÖ Whitelist —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Ç—Ä–∏ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –Ω–æ–º–µ—Ä–∞
3. ‚úÖ –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É—é—Ç—Å—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
4. ‚úÖ –ö–æ–Ω—Ç–∞–∫—Ç—ã –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (isClient: true/false/null)
5. ‚úÖ –ö–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –æ—Ç–≤–µ—Ç—ã –æ—Ç AI sales agent
6. ‚úÖ –û—Ç–≤–µ—Ç—ã –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π –∏–∑ PDF
7. ‚úÖ Follow-up –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–ª–∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –æ—Ç–≤–µ—Ç–µ
8. ‚úÖ Follow-up –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–≤–µ—Ç–µ "–î–ê" –∏–ª–∏ "–ù–ï–¢"
9. ‚úÖ –°–æ–∑–≤–æ–Ω—ã –Ω–∞–∑–Ω–∞—á–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è (10:00-18:00 –ê—Å—Ç–∞–Ω–∞)
10. ‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥–∏ (RabbitMQ/Redis)

### **–ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è**
1. ‚úÖ –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è < 10 —Å–µ–∫—É–Ω–¥
2. ‚úÖ –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–∏–Ω–∏–º—É–º 100 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Å
3. ‚úÖ Uptime > 99% (–º–∞–∫—Å–∏–º—É–º 7 —á–∞—Å–æ–≤ downtime –≤ –º–µ—Å—è—Ü)
4. ‚úÖ –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –≤ –∫–æ–¥–µ)
5. ‚úÖ –õ–æ–≥–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –º–∏–Ω–∏–º—É–º 30 –¥–Ω–µ–π
6. ‚úÖ –ö–æ–¥ –ø–æ–∫—Ä—ã—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
7. ‚úÖ –ï—Å—Ç—å health endpoints –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
8. ‚úÖ Graceful shutdown –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–µ—Ä–≤–∏—Å–æ–≤

### **–ö–∞—á–µ—Å—Ç–≤–æ AI**
1. ‚úÖ –¢–æ—á–Ω–æ—Å—Ç—å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ > 90%
2. ‚úÖ –û—Ç–≤–µ—Ç—ã sales agent —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
3. ‚úÖ –°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π
4. ‚úÖ –î–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π 2-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (–Ω–µ –±–æ–ª–µ–µ)
5. ‚úÖ –≠–º–æ–¥–∑–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —É–º–µ—Ä–µ–Ω–Ω–æ (1-2 –Ω–∞ —Å–æ–æ–±