# üìã –ü–û–õ–ù–û–ï –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï: WhatsApp AI Agent System

## üéØ –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ **–¥–≤—É—Ö –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤**, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö —á–µ—Ä–µ–∑ **–æ—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (RabbitMQ/Redis)**.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        –ü–†–û–ï–ö–¢ 1                                  ‚îÇ
‚îÇ                  WhatsApp Gateway Service                        ‚îÇ
‚îÇ              (–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Wappi.pro API)                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚îÇ RabbitMQ/Redis Queue
                     ‚îÇ
                     ‚ñº
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ   incoming_messages Queue   ‚îÇ
        ‚îÇ   outgoing_messages Queue   ‚îÇ
        ‚îÇ   voice_transcription Queue ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚îÇ
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        –ü–†–û–ï–ö–¢ 2                                  ‚îÇ
‚îÇ                   AI Agent Service                               ‚îÇ
‚îÇ          (Gemini 2.5 Pro + Business Logic)                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üì¶ –ü–†–û–ï–ö–¢ 1: WhatsApp Gateway Service

### **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**
–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≤—Å–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å WhatsApp —á–µ—Ä–µ–∑ Wappi.pro API. –ü–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç—ã, —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç –≥–æ–ª–æ—Å–æ–≤—ã–µ.

### **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏**
- **Backend**: Python 3.11+
- **Framework**: FastAPI (–¥–ª—è health-check endpoints)
- **Queue**: RabbitMQ (–∏–ª–∏ Redis —Å pub/sub)
- **Database**: PostgreSQL (—Ç–æ–ª—å–∫–æ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤)
- **Hosting**: Render.com

---

### **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**

#### 1. **Message Polling Service**
**–§–∞–π–ª**: `services/polling_service.py`

**–§—É–Ω–∫—Ü–∏–∏**:
- Polling Wappi API –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
- –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —á–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ `POST /api/sync/chats/get`
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ whitelist (–ø—Ä–æ–ø—É—Å–∫ –Ω–æ–º–µ—Ä–æ–≤: +77752837306, +77018855588, +77088098009)
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –æ—á–µ—Ä–µ–¥—å `incoming_messages`

**Endpoints Wappi**:
```
POST https://wappi.pro/api/sync/chats/get
Headers: Authorization: {Token}
Params:
  - profile_id: {profile_id}
  - limit: 100
  - offset: 0
```

**–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å**:
```json
{
  "message_id": "3EB0128AE55B5D222DD0",
  "chat_id": "79115576362@c.us",
  "phone_number": "79115576362",
  "sender_name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
  "message_text": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç –≤–∞—à –ø—Ä–æ–¥—É–∫—Ç",
  "is_voice": false,
  "voice_url": null,
  "timestamp": "2025-10-05T14:30:00+05:00",
  "contact_info": {
    "FirstName": "–ò–≤–∞–Ω",
    "FullName": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
    "PushName": "Ivan",
    "BusinessName": "–û–û–û –ö–æ–º–ø–∞–Ω–∏—è"
  }
}
```

---

#### 2. **Message Sender Service**
**–§–∞–π–ª**: `services/sender_service.py`

**–§—É–Ω–∫—Ü–∏–∏**:
- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ—á–µ—Ä–µ–¥—å `outgoing_messages`
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ Wappi API
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏
- –û—Ç–º–µ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö

**Endpoints Wappi**:
```
POST https://wappi.pro/api/sync/message/send
Body: {
  "body": "—Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞",
  "recipient": "79115576362"
}

POST https://wappi.pro/api/sync/message/reply
Body: {
  "body": "—Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞",
  "message_id": "3EB0F4D080603C3C0C0A"
}

POST https://wappi.pro/api/sync/message/mark/read
Body: {
  "message_id": "3EB04E6C3BF173879610C0"
}
```

**–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –æ—á–µ—Ä–µ–¥–∏**:
```json
{
  "phone_number": "79115576362",
  "message_text": "–°–ø–∞—Å–∏–±–æ –∑–∞ –∏–Ω—Ç–µ—Ä–µ—Å! –ù–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞ üòä",
  "reply_to_message_id": "3EB0128AE55B5D222DD0",
  "mark_as_read": true
}
```

---

#### 3. **Voice Transcription Service**
**–§–∞–π–ª**: `services/voice_service.py`

**–§—É–Ω–∫—Ü–∏–∏**:
- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ—á–µ—Ä–µ–¥—å `voice_transcription`
- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ Wappi API
- –û—Ç–ø—Ä–∞–≤–∫–∞ –∞—É–¥–∏–æ –≤ Gemini 2.5 Pro –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –æ–±—Ä–∞—Ç–Ω–æ –≤ `incoming_messages`

**Endpoints Wappi**:
```
GET https://wappi.pro/api/sync/messages/file
Params: messageId={message_id}
```

**–§–æ—Ä–º–∞—Ç –≤ –æ—á–µ—Ä–µ–¥—å `voice_transcription`**:
```json
{
  "message_id": "3EB0128AE55B5D222DD0",
  "chat_id": "79115576362@c.us",
  "phone_number": "79115576362",
  "voice_url": "https://wappi.pro/files/...",
  "timestamp": "2025-10-05T14:30:00+05:00"
}
```

**–§–æ—Ä–º–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ `incoming_messages`**:
```json
{
  "message_id": "3EB0128AE55B5D222DD0",
  "chat_id": "79115576362@c.us",
  "phone_number": "79115576362",
  "message_text": "[–¢–†–ê–ù–°–ö–†–ò–ë–ê–¶–ò–Ø] –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —Ö–æ—á—É —É–∑–Ω–∞—Ç—å –æ –≤–∞—à–µ–º –ø—Ä–æ–¥—É–∫—Ç–µ",
  "is_voice": true,
  "original_voice_url": "https://wappi.pro/files/...",
  "timestamp": "2025-10-05T14:30:00+05:00"
}
```

---

#### 4. **Health Check API**
**–§–∞–π–ª**: `api/health.py`

**Endpoints**:
```
GET /health
Response: {
  "status": "healthy",
  "wappi_connection": "ok",
  "queue_connection": "ok",
  "last_poll_time": "2025-10-05T14:35:00+05:00"
}

GET /stats
Response: {
  "messages_received_today": 142,
  "messages_sent_today": 138,
  "voice_transcribed_today": 12,
  "queue_size": {
    "incoming": 3,
    "outgoing": 1,
    "voice": 0
  }
}
```

---

### **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ü–†–û–ï–ö–¢ 1**

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –ª–æ–≥–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
CREATE TABLE message_logs (
    id SERIAL PRIMARY KEY,
    message_id VARCHAR(255) UNIQUE,
    phone_number VARCHAR(20),
    direction VARCHAR(10), -- 'incoming' –∏–ª–∏ 'outgoing'
    message_text TEXT,
    is_voice BOOLEAN DEFAULT FALSE,
    wappi_status VARCHAR(50),
    queue_status VARCHAR(50),
    created_at TIMESTAMP DEFAULT NOW(),
    processed_at TIMESTAMP
);

-- –¢–∞–±–ª–∏—Ü–∞ whitelist
CREATE TABLE whitelist (
    id SERIAL PRIMARY KEY,
    phone_number VARCHAR(20) UNIQUE NOT NULL,
    note TEXT,
    added_at TIMESTAMP DEFAULT NOW()
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_message_logs_phone ON message_logs(phone_number);
CREATE INDEX idx_message_logs_created ON message_logs(created_at);
```

**–ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ whitelist**:
```sql
INSERT INTO whitelist (phone_number, note) VALUES 
('77752837306', '–õ–∏—á–Ω—ã–π –Ω–æ–º–µ—Ä 1'),
('77018855588', '–õ–∏—á–Ω—ã–π –Ω–æ–º–µ—Ä 2'),
('77088098009', '–õ–∏—á–Ω—ã–π –Ω–æ–º–µ—Ä 3');
```

---

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü–†–û–ï–ö–¢ 1**

```
whatsapp-gateway/
‚îÇ
‚îú‚îÄ‚îÄ app.py                          # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª (–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤)
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ Dockerfile
‚îÇ
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ settings.py                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database.py                 # PostgreSQL
‚îÇ   ‚îî‚îÄ‚îÄ queue.py                    # RabbitMQ/Redis
‚îÇ
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ polling_service.py          # Polling Wappi
‚îÇ   ‚îú‚îÄ‚îÄ sender_service.py           # –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Wappi
‚îÇ   ‚îú‚îÄ‚îÄ voice_service.py            # –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ wappi_client.py             # Wrappper –¥–ª—è Wappi API
‚îÇ
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ health.py                   # Health check endpoints
‚îÇ
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ message_log.py
‚îÇ   ‚îî‚îÄ‚îÄ whitelist.py
‚îÇ
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ logger.py
‚îÇ   ‚îî‚îÄ‚îÄ helpers.py
‚îÇ
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îî‚îÄ‚îÄ test_wappi.py
```

---

### **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ü–†–û–ï–ö–¢ 1**

```env
# Project Name
PROJECT_NAME=whatsapp-gateway

# Wappi API
WAPPI_TOKEN=your_wappi_token
WAPPI_PROFILE_ID=your_profile_id
WAPPI_PHONE_NUMBER=77752837306

# Database
DATABASE_URL=postgresql://user:password@host:5432/whatsapp_gateway

# Queue (RabbitMQ)
RABBITMQ_URL=amqp://user:password@host:5672/
QUEUE_INCOMING_MESSAGES=incoming_messages
QUEUE_OUTGOING_MESSAGES=outgoing_messages
QUEUE_VOICE_TRANSCRIPTION=voice_transcription

# Settings
POLLING_INTERVAL=5
LOG_LEVEL=INFO
TIMEZONE=Asia/Almaty
```

---

## üì¶ –ü–†–û–ï–ö–¢ 2: AI Agent Service

### **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**
–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª–æ–≥–∏–∫—É –±–∏–∑–Ω–µ—Å–∞, –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤, –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –æ—Ç–≤–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ Gemini 2.5 Pro, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ follow-up.

### **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏**
- **Backend**: Python 3.11+
- **AI**: Gemini 2.5 Pro API
- **Queue**: RabbitMQ (–∏–ª–∏ Redis)
- **Database**: PostgreSQL (–æ—Å–Ω–æ–≤–Ω–∞—è –ë–î —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏, —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏, follow-up)
- **Hosting**: Render.com

---

### **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**

#### 1. **Message Consumer Service**
**–§–∞–π–ª**: `services/message_consumer.py`

**–§—É–Ω–∫—Ü–∏–∏**:
- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ—á–µ—Ä–µ–¥—å `incoming_messages`
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ë–î
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞ (isClient)
- –ü–µ—Ä–µ–¥–∞—á–∞ –≤ AI Moderator (–µ—Å–ª–∏ isClient = null)
- –ü–µ—Ä–µ–¥–∞—á–∞ –≤ AI Sales Agent (–µ—Å–ª–∏ isClient = true)
- –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ (–µ—Å–ª–∏ isClient = false)

---

#### 2. **AI Moderator Service**
**–§–∞–π–ª**: `services/ai_moderator.py`

**–§—É–Ω–∫—Ü–∏–∏**:
- –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –ø–µ—Ä–µ–ø–∏—Å–∫–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Gemini 2.5 Pro —Å –ø—Ä–æ–º–ø—Ç–æ–º –∏–∑ `prompts/moderator_prompt.txt`
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `isClient`:
  - `true` - –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π/–¥–µ–π—Å—Ç–≤—É—é—â–∏–π –∫–ª–∏–µ–Ω—Ç
  - `false` - –Ω–µ –∫–ª–∏–µ–Ω—Ç (—Å–ø–∞–º, –ª–∏—á–Ω–æ–µ)
  - `null` - –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ –ë–î

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏**:

**isClient = TRUE**:
- –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
- –ó–∞–¥–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã –æ –ø—Ä–æ–¥—É–∫—Ç–∞—Ö/—É—Å–ª—É–≥–∞—Ö/—Ü–µ–Ω–∞—Ö
- –î–µ–ª–æ–≤–æ–π —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è
- –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ö–ü, –¥–µ—Ç–∞–ª–∏, —É—Å–ª–æ–≤–∏—è
- –£–ø–æ–º–∏–Ω–∞–µ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤

**isClient = FALSE**:
- –°–ø–∞–º-—Å–æ–æ–±—â–µ–Ω–∏—è
- –†–µ–∫–ª–∞–º–∞ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —É—Å–ª—É–≥
- –õ–∏—á–Ω—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã (–Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω —Å –ª–∏—á–Ω—ã–º –∏–º–µ–Ω–µ–º –±–µ–∑ –∫–æ–º–ø–∞–Ω–∏–∏

**isClient = NULL**:
- –ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ú–µ–Ω–µ–µ 3 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ø–µ—Ä–µ–ø–∏—Å–∫–µ
- –ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä

**–ü—Ä–æ–º–ø—Ç**: `prompts/moderator_prompt.txt`

---

#### 3. **AI Sales Agent Service**
**–§–∞–π–ª**: `services/ai_sales_agent.py`

**–§—É–Ω–∫—Ü–∏–∏**:
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞–º —á–µ—Ä–µ–∑ Gemini 2.5 Pro
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –∏–∑ PDF (`knowledge_base/product_info.pdf`)
- –ö–æ–Ω—Ç–µ–∫—Å—Ç: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –ë–î
- –ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–∏–¥–æ–≤ (–°–ü–ò–ù-–ø—Ä–æ–¥–∞–∂–∏)
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–æ–∑–≤–æ–Ω–æ–≤ (—Ç–æ–ª—å–∫–æ –≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è 10:00-18:00 –ø–æ –ê—Å—Ç–∞–Ω–µ)
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –≤ –æ—á–µ—Ä–µ–¥—å `outgoing_messages`

**–õ–æ–≥–∏–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Å–æ–∑–≤–æ–Ω–æ–≤**:
- –ö–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —è–≤–Ω–æ —Å–æ–≥–ª–∞—Å–∏—Ç—å—Å—è: "–î–∞, –≥–æ—Ç–æ–≤", "–î–∞–≤–∞–π—Ç–µ —Å–æ–∑–≤–æ–Ω–∏–º—Å—è"
- –ò–ò –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 10:00-18:00 (Astana timezone)
- –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤—Ä–µ–º—è –≤–Ω–µ —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤ ‚Üí –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –±–ª–∏–∂–∞–π—à–µ–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ

**–ü—Ä–æ–º–ø—Ç**: `prompts/sales_agent_prompt.txt`

---

#### 4. **Follow-up Scheduler Service**
**–§–∞–π–ª**: `services/follow_up_scheduler.py`

**–§—É–Ω–∫—Ü–∏–∏**:
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –±–µ–∑ –æ—Ç–≤–µ—Ç–∞
- –ó–∞–ø—É—Å–∫ —Ü–µ–ø–æ—á–∫–∏ –∏–∑ 5 –∫–∞—Å–∞–Ω–∏–π
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è follow-up —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ Gemini
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –æ—á–µ—Ä–µ–¥—å `outgoing_messages`

**–õ–æ–≥–∏–∫–∞ Follow-up**:

**–ö–æ–≥–¥–∞ –ó–ê–ü–£–°–ö–ê–¢–¨ follow-up**:
- –ö–ª–∏–µ–Ω—Ç –ù–ï –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç–∞
- –ö–ª–∏–µ–Ω—Ç –¥–∞–ª –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç ("–ø–æ—Å–º–æ—Ç—Ä—é", "–ø–æ–¥—É–º–∞—é", "–º–æ–∂–µ—Ç –±—ã—Ç—å")

**–ö–æ–≥–¥–∞ –ù–ï –∑–∞–ø—É—Å–∫–∞—Ç—å follow-up**:
- –ö–ª–∏–µ–Ω—Ç –¥–∞–ª —Ç–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç **–î–ê** ("–î–∞", "–°–æ–≥–ª–∞—Å–µ–Ω", "–ì–æ—Ç–æ–≤", "–î–∞–≤–∞–π—Ç–µ")
- –ö–ª–∏–µ–Ω—Ç –¥–∞–ª —Ç–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç **–ù–ï–¢** ("–ù–µ—Ç", "–ù–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ", "–ù–µ –Ω–∞–¥–æ")
- –ö–ª–∏–µ–Ω—Ç –∞–∫—Ç–∏–≤–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç (–ø–µ—Ä–µ–ø–∏—Å–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è)

**–ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –º–µ–∂–¥—É –∫–∞—Å–∞–Ω–∏—è–º–∏** (Astana timezone):
```
–ö–∞—Å–∞–Ω–∏–µ 1: —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞
–ö–∞—Å–∞–Ω–∏–µ 2: —á–µ—Ä–µ–∑ 3 –¥–Ω—è (72 —á–∞—Å–∞)
–ö–∞—Å–∞–Ω–∏–µ 3: —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π (168 —á–∞—Å–æ–≤)
–ö–∞—Å–∞–Ω–∏–µ 4: —á–µ—Ä–µ–∑ 14 –¥–Ω–µ–π (336 —á–∞—Å–æ–≤)
–ö–∞—Å–∞–Ω–∏–µ 5: —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π (720 —á–∞—Å–æ–≤)
```

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ –∫–∞—Å–∞–Ω–∏—è–º**:
- **–ö–∞—Å–∞–Ω–∏–µ 1**: –î—Ä—É–∂–µ–ª—é–±–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
- **–ö–∞—Å–∞–Ω–∏–µ 2**: –¶–µ–Ω–Ω–æ—Å—Ç–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
- **–ö–∞—Å–∞–Ω–∏–µ 3**: –°–æ—Ü–∏–∞–ª—å–Ω–æ–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ (–∫–µ–π—Å—ã, –æ—Ç–∑—ã–≤—ã)
- **–ö–∞—Å–∞–Ω–∏–µ 4**: –ü–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ)
- **–ö–∞—Å–∞–Ω–∏–µ 5**: –ü—Ä–æ—â–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

**–ü—Ä–æ–º–ø—Ç**: `prompts/follow_up_prompt.txt`

---

#### 5. **Knowledge Base Loader**
**–§–∞–π–ª**: `services/knowledge_loader.py`

**–§—É–Ω–∫—Ü–∏–∏**:
- –ó–∞–≥—Ä—É–∑–∫–∞ PDF —Ñ–∞–π–ª–æ–≤ –∏–∑ `knowledge_base/`
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ PyPDF2 –∏–ª–∏ pdfplumber
- –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏ –∏–ª–∏ Redis

**–§–∞–π–ª—ã –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π**:
```
knowledge_base/
‚îú‚îÄ‚îÄ product_info.pdf        # –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥—É–∫—Ç–µ
‚îú‚îÄ‚îÄ pricing.pdf             # –ü—Ä–∞–π—Å-–ª–∏—Å—Ç
‚îî‚îÄ‚îÄ faq.pdf                 # –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã
```

---

#### 6. **Health Check API**
**–§–∞–π–ª**: `api/health.py`

**Endpoints**:
```
GET /health
GET /stats
GET /contacts/{phone}
GET /follow-ups/pending
```

---

### **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ü–†–û–ï–ö–¢ 2**

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
CREATE TABLE contacts (
    id SERIAL PRIMARY KEY,
    phone_number VARCHAR(20) UNIQUE NOT NULL,
    name VARCHAR(255),
    full_name VARCHAR(255),
    business_name VARCHAR(255),
    is_client BOOLEAN DEFAULT NULL,
    classification_confidence FLOAT,
    classification_reasoning TEXT,
    last_message_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- –¢–∞–±–ª–∏—Ü–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (–ø–∞–º—è—Ç—å - –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20)
CREATE TABLE messages (
    id SERIAL PRIMARY KEY,
    contact_id INTEGER REFERENCES contacts(id) ON DELETE CASCADE,
    phone_number VARCHAR(20) NOT NULL,
    message_id VARCHAR(255) UNIQUE,
    message_text TEXT,
    is_from_bot BOOLEAN DEFAULT FALSE,
    is_voice BOOLEAN DEFAULT FALSE,
    voice_transcription TEXT,
    timestamp TIMESTAMP DEFAULT NOW()
);

-- –¢–∞–±–ª–∏—Ü–∞ follow-up
CREATE TABLE follow_ups (
    id SERIAL PRIMARY KEY,
    contact_id INTEGER REFERENCES contacts(id) ON DELETE CASCADE,
    touch_number INTEGER DEFAULT 1 CHECK (touch_number BETWEEN 1 AND 5),
    next_touch_at TIMESTAMP,
    last_touch_at TIMESTAMP,
    is_completed BOOLEAN DEFAULT FALSE,
    stop_reason VARCHAR(100), -- 'client_responded', 'client_said_yes', 'client_said_no', 'completed_5_touches'
    created_at TIMESTAMP DEFAULT NOW()
);

-- –¢–∞–±–ª–∏—Ü–∞ —Å–æ–∑–≤–æ–Ω–æ–≤
CREATE TABLE scheduled_calls (
    id SERIAL PRIMARY KEY,
    contact_id INTEGER REFERENCES contacts(id) ON DELETE CASCADE,
    scheduled_at TIMESTAMP NOT NULL,
    timezone VARCHAR(50) DEFAULT 'Asia/Almaty',
    status VARCHAR(50) DEFAULT 'scheduled', -- 'scheduled', 'completed', 'cancelled'
    notes TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_contacts_is_client ON contacts(is_client);
CREATE INDEX idx_contacts_phone ON contacts(phone_number);
CREATE INDEX idx_messages_contact_id ON messages(contact_id);
CREATE INDEX idx_messages_timestamp ON messages(timestamp DESC);
CREATE INDEX idx_follow_ups_next_touch ON follow_ups(next_touch_at) WHERE is_completed = FALSE;
CREATE INDEX idx_scheduled_calls_time ON scheduled_calls(scheduled_at);
```

---

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü–†–û–ï–ö–¢ 2**

```
ai-agent-service/
‚îÇ
‚îú‚îÄ‚îÄ app.py                          # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ Dockerfile
‚îÇ
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ settings.py                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database.py                 # PostgreSQL
‚îÇ   ‚îî‚îÄ‚îÄ queue.py                    # RabbitMQ/Redis
‚îÇ
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ message_consumer.py         # Consumer –∏–∑ –æ—á–µ—Ä–µ–¥–∏
‚îÇ   ‚îú‚îÄ‚îÄ ai_moderator.py             # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ ai_sales_agent.py           # Sales –∞–≥–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ follow_up_scheduler.py      # Follow-up —Å–∏—Å—Ç–µ–º–∞
‚îÇ   ‚îú‚îÄ‚îÄ knowledge_loader.py         # –ó–∞–≥—Ä—É–∑–∫–∞ PDF –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ gemini_client.py            # Wrapper –¥–ª—è Gemini API
‚îÇ
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ health.py                   # Health check
‚îÇ   ‚îî‚îÄ‚îÄ contacts.py                 # CRUD –∫–æ–Ω—Ç–∞–∫—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îÇ
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ contact.py                  # ORM Contact
‚îÇ   ‚îú‚îÄ‚îÄ message.py                  # ORM Message
‚îÇ   ‚îú‚îÄ‚îÄ follow_up.py                # ORM FollowUp
‚îÇ   ‚îî‚îÄ‚îÄ scheduled_call.py           # ORM ScheduledCall
‚îÇ
‚îú‚îÄ‚îÄ prompts/
‚îÇ   ‚îú‚îÄ‚îÄ moderator_prompt.txt        # –ü—Ä–æ–º–ø—Ç –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ sales_agent_prompt.txt      # –ü—Ä–æ–º–ø—Ç –¥–ª—è sales
‚îÇ   ‚îî‚îÄ‚îÄ follow_up_prompt.txt        # –ü—Ä–æ–º–ø—Ç –¥–ª—è follow-up
‚îÇ
‚îú‚îÄ‚îÄ knowledge_base/
‚îÇ   ‚îú‚îÄ‚îÄ product_info.pdf            # –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –æ –ø—Ä–æ–¥—É–∫—Ç–µ
‚îÇ   ‚îú‚îÄ‚îÄ pricing.pdf                 # –¶–µ–Ω—ã
‚îÇ   ‚îî‚îÄ‚îÄ faq.pdf                     # FAQ
‚îÇ
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ logger.py
‚îÇ   ‚îú‚îÄ‚îÄ timezone_helper.py          # –†–∞–±–æ—Ç–∞ —Å Astana timezone
‚îÇ   ‚îî‚îÄ‚îÄ helpers.py
‚îÇ
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ test_moderator.py
    ‚îî‚îÄ‚îÄ test_sales_agent.py
```

---

### **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ü–†–û–ï–ö–¢ 2**

```env
# Project Name
PROJECT_NAME=ai-agent-service

# Gemini API
GEMINI_API_KEY=your_gemini_api_key
GEMINI_MODEL=gemini-2.5-pro

# Database
DATABASE_URL=postgresql://user:password@host:5432/ai_agent

# Queue (RabbitMQ)
RABBITMQ_URL=amqp://user:password@host:5672/
QUEUE_INCOMING_MESSAGES=incoming_messages
QUEUE_OUTGOING_MESSAGES=outgoing_messages

# Settings
MAX_CONTEXT_MESSAGES=20
ENABLE_FOLLOW_UPS=true
FOLLOW_UP_INTERVALS=24,72,168,336,720
TIMEZONE=Asia/Almaty
WORKING_HOURS_START=10
WORKING_HOURS_END=18

# Knowledge Base
KNOWLEDGE_BASE_PATH=./knowledge_base/
PDF_CACHE_ENABLED=true

# Logging
LOG_LEVEL=INFO
```

---

## üîÑ –°—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤

### **–ü–æ—Ç–æ–∫ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π**

```
1. –ü–†–û–ï–ö–¢ 1: Polling Wappi API ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
2. –ü–†–û–ï–ö–¢ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ whitelist ‚Üí –µ—Å–ª–∏ –≤ whitelist, –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
3. –ü–†–û–ï–ö–¢ 1: –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –æ—á–µ—Ä–µ–¥—å `incoming_messages`
4. –ü–†–û–ï–ö–¢ 2: Consumer –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –æ—á–µ—Ä–µ–¥–∏
5. –ü–†–û–ï–ö–¢ 2: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ë–î
6. –ü–†–û–ï–ö–¢ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –≤ –ë–î
   - –ï—Å–ª–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –Ω–µ—Ç ‚Üí —Å–æ–∑–¥–∞—Ç—å, is_client = NULL
   - –ï—Å–ª–∏ is_client = NULL ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ AI Moderator
   - –ï—Å–ª–∏ is_client = FALSE ‚Üí –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å
   - –ï—Å–ª–∏ is_client = TRUE ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ AI Sales Agent
7. –ü–†–û–ï–ö–¢ 2: AI Moderator –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç
8. –ü–†–û–ï–ö–¢ 2: AI Sales Agent –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç
9. –ü–†–û–ï–ö–¢ 2: –ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –≤ –æ—á–µ—Ä–µ–¥—å `outgoing_messages`
10. –ü–†–û–ï–ö–¢ 1: Consumer –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —á–µ—Ä–µ–∑ Wappi
```

### **–ü–æ—Ç–æ–∫ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π**

```
1. –ü–†–û–ï–ö–¢ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
2. –ü–†–û–ï–ö–¢ 1: –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –æ—á–µ—Ä–µ–¥—å `voice_transcription`
3. –ü–†–û–ï–ö–¢ 1: Voice Service —Å–∫–∞—á–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ
4. –ü–†–û–ï–ö–¢ 1: –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Gemini –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
5. –ü–†–û–ï–ö–¢ 1: –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –≤ `incoming_messages`
6. –ü–†–û–ï–ö–¢ 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
```

### **–ü–æ—Ç–æ–∫ Follow-up**

```
1. –ü–†–û–ï–ö–¢ 2: Follow-up Scheduler –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç—ã –±–µ–∑ –æ—Ç–≤–µ—Ç–∞
2. –ü–†–û–ï–ö–¢ 2: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: –Ω—É–∂–µ–Ω –ª–∏ follow-up
   - –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —Å–∫–∞–∑–∞–ª "–î–ê" –∏–ª–∏ "–ù–ï–¢" ‚Üí –ù–ï –Ω—É–∂–µ–Ω
   - –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª ‚Üí –Ω—É–∂–µ–Ω
3. –ü–†–û–ï–ö–¢ 2: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ follow_ups
4. –ü–†–û–ï–ö–¢ 2: –ß–µ—Ä–µ–∑ N —á–∞—Å–æ–≤ ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è follow-up —Å–æ–æ–±—â–µ–Ω–∏—è
5. –ü–†–û–ï–ö–¢ 2: –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –æ—á–µ—Ä–µ–¥—å `outgoing_messages`
6. –ü–†–û–ï–ö–¢ 1: –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Wappi
```

---

## üìù –ü—Ä–æ–º–ø—Ç—ã (–¥–µ—Ç–∞–ª—å–Ω–æ)

### **prompts/moderator_prompt.txt**

```
–¢—ã - AI –º–æ–¥–µ—Ä–∞—Ç–æ—Ä WhatsApp —á–∞—Ç–æ–≤ –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏ [–ù–ê–ó–í–ê–ù–ò–ï –ö–û–ú–ü–ê–ù–ò–ò].

–¢–≤–æ—è –∑–∞–¥–∞—á–∞: –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ—Ç –∫–æ–Ω—Ç–∞–∫—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º –∏–ª–∏ –¥–µ–π—Å—Ç–≤—É—é—â–∏–º –∫–ª–∏–µ–Ω—Ç–æ–º.

–ö–†–ò–¢–ï–†–ò–ò –ö–õ–ò–ï–ù–¢–ê (isClient = true):
‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∏–ª–∏ –¥–æ–ª–∂–Ω–æ—Å—Ç—å
‚úÖ –ó–∞–¥–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã –æ –ø—Ä–æ–¥—É–∫—Ç–∞—Ö, —É—Å–ª—É–≥–∞—Ö, —Ü–µ–Ω–∞—Ö, —É—Å–ª–æ–≤–∏—è—Ö
‚úÖ –î–µ–ª–æ–≤–æ–π —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è (–±–µ–∑ –∏–∑–ª–∏—à–Ω–∏—Ö —ç–º–æ–¥–∑–∏)
‚úÖ –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ, –¥–æ–≥–æ–≤–æ—Ä, –¥–µ—Ç–∞–ª–∏
‚úÖ –£–ø–æ–º–∏–Ω–∞–µ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏ –ø—Ä–æ–¥—É–∫—Ç–∞
‚úÖ –ò–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç—Å—è —Å—Ä–æ–∫–∞–º–∏, –¥–æ—Å—Ç–∞–≤–∫–æ–π, –≥–∞—Ä–∞–Ω—Ç–∏–µ–π
‚úÖ –ì–æ–≤–æ—Ä–∏—Ç –æ –±—é–¥–∂–µ—Ç–µ, –∑–∞–∫—É–ø–∫–∞—Ö, —Ç–µ–Ω–¥–µ—Ä–∞—Ö

–ö–†–ò–¢–ï–†–ò–ò –ù–ï-–ö–õ–ò–ï–ù–¢–ê (isClient = false):
‚ùå –°–ø–∞–º-—Å–æ–æ–±—â–µ–Ω–∏—è, —Ä–µ–∫–ª–∞–º–∞ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —É—Å–ª—É–≥
‚ùå –Ø–≤–Ω–æ –ª–∏—á–Ω—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã (–ø—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞, —á—Ç–æ –¥–µ–ª–∞–µ—à—å)
‚ùå –°–æ—Ö—Ä–∞–Ω–µ–Ω —Ç–æ–ª—å–∫–æ —Å –ª–∏—á–Ω—ã–º –∏–º–µ–Ω–µ–º (–±–µ–∑ –∫–æ–º–ø–∞–Ω–∏–∏)
‚ùå –ù–µ—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —ç–º–æ–¥–∑–∏ üòÇüî•‚ù§Ô∏è
‚ùå –ü—Ä–æ—Å—å–±—ã –æ –ª–∏—á–Ω–æ–π –ø–æ–º–æ—â–∏, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –±–∏–∑–Ω–µ—Å–æ–º
‚ùå –°–æ–æ–±—â–µ–Ω–∏—è —Ç–∏–ø–∞ "–æ—à–∏–±–ª–∏—Å—å –Ω–æ–º–µ—Ä–æ–º", "–∫—Ç–æ —ç—Ç–æ?"

–ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –î–ê–ù–ù–´–• (isClient = null):
‚ö†Ô∏è –ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ç–∏–ø–∞ "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ" –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
‚ö†Ô∏è –ú–µ–Ω–µ–µ 3 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ø–µ—Ä–µ–ø–∏—Å–∫–µ
‚ö†Ô∏è –ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –æ–±—â–µ–Ω–∏—è
‚ö†Ô∏è –ù—É–∂–Ω–æ –±–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è

–ê–ù–ê–õ–ò–ó–ò–†–£–ï–ú–´–ô –ö–û–ù–¢–ê–ö–¢:
–ò–º—è –≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö: {contact_name}
–ü–æ–ª–Ω–æ–µ –∏–º—è: {full_name}
–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏: {business_name}

–ò–°–¢–û–†–ò–Ø –ü–ï–†–ï–ü–ò–°–ö–ò (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π):
{conversation_history}

–ò–ù–°–¢–†–£–ö–¶–ò–Ø:
1. –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–π –≤—Å—é –ø–µ—Ä–µ–ø–∏—Å–∫—É
2. –û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∏–º—è –∫–æ–Ω—Ç–∞–∫—Ç–∞ –∏ –Ω–∞–ª–∏—á–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
3. –û—Ü–µ–Ω–∏ —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è –∏ –Ω–∞–º–µ—Ä–µ–Ω–∏—è
4. –ü—Ä–∏—Å–≤–æ–π –æ—Ü–µ–Ω–∫—É —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (0.0 - 1.0)
5. –î–∞–π –∫—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Å–≤–æ–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è

–û–¢–í–ï–¢–¨ –°–¢–†–û–ì–û –í JSON –§–û–†–ú–ê–¢–ï:
{
  "isClient": true,
  "confidence": 0.85,
  "reasoning": "–ö–æ–Ω—Ç–∞–∫—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∫–∞–∫ '–ò–≤–∞–Ω - –û–û–û –°—Ç—Ä–æ–π–∫–æ–º', –∑–∞–¥–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã –æ —Ü–µ–Ω–∞—Ö –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –¥–µ–ª–æ–≤–æ–π —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è"
}
```

---

### **prompts/sales_agent_prompt.txt**

```
–¢—ã - AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º –∫–æ–º–ø–∞–Ω–∏–∏ [–ù–ê–ó–í–ê–ù–ò–ï –ö–û–ú–ü–ê–ù–ò–ò].

–¢–í–û–Ø –†–û–õ–¨ –ò –§–£–ù–ö–¶–ò–ò:
üéØ –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –∏ –ø—Ä–æ–¥–∞–≤–µ—Ü
üéØ –ö–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä—É–µ—à—å –ª–∏–¥—ã (–°–ü–ò–ù-–ø—Ä–æ–¥–∞–∂–∏)
üéØ –û—Ç–≤–µ—á–∞–µ—à—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –ø—Ä–æ–¥—É–∫—Ç–∞—Ö
üéØ –ù–∞–∑–Ω–∞—á–∞–µ—à—å —Å–æ–∑–≤–æ–Ω—ã —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º

–°–¢–ò–õ–¨ –û–ë–©–ï–ù–ò–Ø:
‚úÖ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, –Ω–æ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π
‚úÖ –ö–æ—Ä–æ—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è (2-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –º–∞–∫—Å–∏–º—É–º)
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ —É–º–µ—Ä–µ–Ω–Ω–æ (1-2 –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ, —Ç–æ–ª—å–∫–æ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ: ‚úÖüòäüëç)
‚úÖ –ó–∞–¥–∞–≤–∞–π —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã
‚úÖ –ü–∏—à–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
‚úÖ –û–±—Ä–∞—â–∞–π—Å—è –Ω–∞ "–í—ã" (–µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –Ω–µ –ø—Ä–æ—Å–∏—Ç –Ω–∞ "—Ç—ã")

–°–¢–†–ê–¢–ï–ì–ò–Ø –°–ü–ò–ù-–ü–†–û–î–ê–ñ:
1. –°–ò–¢–£–ê–¶–ò–Ø: –í—ã—è—Å–Ω–∏ —Ç–µ–∫—É—â—É—é —Å–∏—Ç—É–∞—Ü–∏—é –∫–ª–∏–µ–Ω—Ç–∞
   - "–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ, —Å –∫–∞–∫–æ–π –∑–∞–¥–∞—á–µ–π –≤—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å?"
   - "–ß—Ç–æ –≤—ã —Å–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏?"

2. –ü–†–û–ë–õ–ï–ú–ê: –û–ø—Ä–µ–¥–µ–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã
   - "–° –∫–∞–∫–∏–º–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—è–º–∏ –≤—ã —Å—Ç–∞–ª–∫–∏–≤–∞–µ—Ç–µ—Å—å?"
   - "–ß—Ç–æ –≤–∞—Å –Ω–µ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –≤ —Ç–µ–∫—É—â–µ–º —Ä–µ—à–µ–Ω–∏–∏?"

3. –ò–ó–í–õ–ï–ß–ï–ù–ò–ï: –£—Å–∏–ª—å –≤–∞–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
   - "–ö–∞–∫ —ç—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤–∞—à –±–∏–∑–Ω–µ—Å?"
   - "–°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏/–¥–µ–Ω–µ–≥ –≤—ã —Ç–µ—Ä—è–µ—Ç–µ –∏–∑-–∑–∞ —ç—Ç–æ–≥–æ?"

4. –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï: –ü–æ–∫–∞–∂–∏ —Ü–µ–Ω–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏—è
   - "–ö–∞–∫ –≤–∞–º –ø–æ–º–æ–∂–µ—Ç [–Ω–∞—à –ø—Ä–æ–¥—É–∫—Ç]?"
   - "–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ —ç—Ç–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞..."

–ù–ê–ó–ù–ê–ß–ï–ù–ò–ï –°–û–ó–í–û–ù–û–í:
‚è∞ –†–ê–ë–û–ß–ï–ï –í–†–ï–ú–Ø: 10:00 - 18:00 (–≤—Ä–µ–º—è –ê—Å—Ç–∞–Ω—ã, UTC+5)
‚è∞ –î–Ω–∏: –ü–Ω-–ü—Ç (—Ä–∞–±–æ—á–∏–µ –¥–Ω–∏)

–ê–õ–ì–û–†–ò–¢–ú:
1. –ö–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –Ø–í–ù–û —Å–æ–≥–ª–∞—Å–∏—Ç—å—Å—è –Ω–∞ —Å–æ–∑–≤–æ–Ω:
   ‚úÖ "–î–∞, –≥–æ—Ç–æ–≤ –∫ —Å–æ–∑–≤–æ–Ω—É"
   ‚úÖ "–î–∞–≤–∞–π—Ç–µ —Å–æ–∑–≤–æ–Ω–∏–º—Å—è"
   ‚úÖ "–ö–æ–≥–¥–∞ –º–æ–∂–Ω–æ –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å?"
   
2. –ó–∞–ø—Ä–æ—Å–∏ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è:
   "–û—Ç–ª–∏—á–Ω–æ! –ö–æ–≥–¥–∞ –≤–∞–º –±—É–¥–µ—Ç —É–¥–æ–±–Ω–æ —Å–æ–∑–≤–æ–Ω–∏—Ç—å—Å—è? –ù–∞—à–∏ –º–µ–Ω–µ–¥–∂–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å 10:00 –¥–æ 18:00 –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –ê—Å—Ç–∞–Ω—ã üìû"

3. –ü—Ä–æ–≤–µ—Ä—å –≤—Ä–µ–º—è:
   ‚úÖ –ï—Å–ª–∏ 10:00-18:00 ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–¥–∏
   ‚ùå –ï—Å–ª–∏ –≤–Ω–µ —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤ ‚Üí –ø—Ä–µ–¥–ª–æ–∂–∏ –±–ª–∏–∂–∞–π—à–µ–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ:
   "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤ —ç—Ç–æ –≤—Ä–µ–º—è –º—ã –Ω–µ —Ä–∞–±–æ—Ç–∞–µ–º. –ú–æ–≥—É –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å [–±–ª–∏–∂–∞–π—à–µ–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –≤—Ä–µ–º—è]?"

4. –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π —Å–æ–∑–≤–æ–Ω:
   "–û—Ç–ª–∏—á–Ω–æ! –ó–∞–ø–∏—Å–∞–ª –≤–∞—Å –Ω–∞ {–¥–∞—Ç–∞} –≤ {–≤—Ä–µ–º—è}. –ù–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä {–∏–º—è} —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –ø–æ –Ω–æ–º–µ—Ä—É {phone}. –î–æ —Å–≤—è–∑–∏! üëç"

–ë–ê–ó–ê –ó–ù–ê–ù–ò–ô –û –ü–†–û–î–£–ö–¢–ê–•:
{knowledge_base}

–í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê:
‚ùó –ï—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—à—å —Ç–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç - –ø—Ä–µ–¥–ª–æ–∂–∏ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º
‚ùó –ù–ï –¥–∞–≤–∞–π —Å–∫–∏–¥–∫–∏ –±–µ–∑ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è
‚ùó –ù–ï –æ–±–µ—â–∞–π —Ç–æ, —á–µ–≥–æ –Ω–µ—Ç –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
‚ùó –ü—Ä–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö - –ø–µ—Ä–µ–≤–æ–¥–∏ –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
‚ùó –ë—É–¥—å —á–µ—Å—Ç–Ω—ã–º: "–°–µ–π—á–∞—Å —É—Ç–æ—á–Ω—é —É –∫–æ–ª–ª–µ–≥" –ª—É—á—à–µ, —á–µ–º –ª–æ–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–ö–û–ù–¢–ï–ö–°–¢ –¢–ï–ö–£–©–ï–ô –ü–ï–†–ï–ü–ò–°–ö–ò:
{conversation_history}

–ù–û–í–û–ï –°–û–û–ë–©–ï–ù–ò–ï –ö–õ–ò–ï–ù–¢–ê:
{new_message}

–¢–ï–ö–£–©–ê–Ø –î–ê–¢–ê –ò –í–†–ï–ú–Ø: {current_datetime} (–ê—Å—Ç–∞–Ω–∞, UTC+5)

–¢–í–û–ô –û–¢–í–ï–¢ (—Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–ª–∏–µ–Ω—Ç—É, –ë–ï–ó –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤):
```

---

### **prompts/follow_up_prompt.txt**

```
–ö–ª–∏–µ–Ω—Ç –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ –Ω–∞—à–µ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ –¥–∞–ª –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç.

–≠—Ç–æ –ö–ê–°–ê–ù–ò–ï #{touch_number} –∏–∑ 5 –≤ —Ä–∞–º–∫–∞—Ö follow-up —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.

–°–¢–†–ê–¢–ï–ì–ò–Ø –ü–û –ö–ê–°–ê–ù–ò–Ø–ú:

üìå –ö–ê–°–ê–ù–ò–ï 1 (—á–µ—Ä–µ–∑ 24 —á–∞—Å–∞):
–°—Ç–∏–ª—å: –î—Ä—É–∂–µ–ª—é–±–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
–¶–µ–ª—å: –í–µ—Ä–Ω—É—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –∫ —Ä–∞–∑–≥–æ–≤–æ—Ä—É
–ü—Ä–∏–º–µ—Ä: "–î–æ–±—Ä—ã–π –¥–µ–Ω—å! üòä –ù–∞–ø–æ–º–∏–Ω–∞—é –æ –Ω–∞—à–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏. –û—Å—Ç–∞–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å—ã?"

üìå –ö–ê–°–ê–ù–ò–ï 2 (—á–µ—Ä–µ–∑ 3 –¥–Ω—è):
–°—Ç–∏–ª—å: –¶–µ–Ω–Ω–æ—Å—Ç–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
–¶–µ–ª—å: –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –≤—ã–≥–æ–¥—É
–ü—Ä–∏–º–µ—Ä: "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –•–æ—á—É –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –Ω–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ –ø–æ–º–æ–∂–µ—Ç —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –¥–æ 30% –±—é–¥–∂–µ—Ç–∞ ‚úÖ"

üìå –ö–ê–°–ê–ù–ò–ï 3 (—á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π):
–°—Ç–∏–ª—å: –°–æ—Ü–∏–∞–ª—å–Ω–æ–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ
–¶–µ–ª—å: –ü–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –¥—Ä—É–≥–∏–µ –≤—ã–±—Ä–∞–ª–∏ –Ω–∞—Å
–ü—Ä–∏–º–µ—Ä: "–ü—Ä–∏–≤–µ—Ç! üëã –ù–µ–¥–∞–≤–Ω–æ –∫–æ–º–ø–∞–Ω–∏—è [–Ω–∞–∑–≤–∞–Ω–∏–µ] –≤–Ω–µ–¥—Ä–∏–ª–∞ –Ω–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ –∏ —Å–æ–∫—Ä–∞—Ç–∏–ª–∞ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ 40%. –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ –æ–±—Å—É–¥–∏—Ç—å –≤–∞—à —Å–ª—É—á–∞–π?"

üìå –ö–ê–°–ê–ù–ò–ï 4 (—á–µ—Ä–µ–∑ 14 –¥–Ω–µ–π):
–°—Ç–∏–ª—å: –ü–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º
–¶–µ–ª—å: –°–æ–∑–¥–∞—Ç—å urgency
–ü—Ä–∏–º–µ—Ä: "–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –í —ç—Ç–æ–º –º–µ—Å—è—Ü–µ —É –Ω–∞—Å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤. –ú–æ–∂–µ–º –æ–±—Å—É–¥–∏—Ç—å?"

üìå –ö–ê–°–ê–ù–ò–ï 5 (—á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π):
–°—Ç–∏–ª—å: –ü—Ä–æ—â–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
–¶–µ–ª—å: –ö—Ä–∞—Å–∏–≤–æ –∑–∞–∫—Ä—ã—Ç—å –∏ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–≤–µ—Ä—å –æ—Ç–∫—Ä—ã—Ç–æ–π
–ü—Ä–∏–º–µ—Ä: "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ü–æ–Ω–∏–º–∞—é, —á—Ç–æ —Å–µ–π—á–∞—Å, –≤–æ–∑–º–æ–∂–Ω–æ, –Ω–µ —Å–∞–º–æ–µ –ø–æ–¥—Ö–æ–¥—è—â–µ–µ –≤—Ä–µ–º—è. –ï—Å–ª–∏ –≤ –±—É–¥—É—â–µ–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –ø–æ–º–æ—â—å - –≤—Å–µ–≥–¥–∞ —Ä–∞–¥—ã –ø–æ–º–æ—á—å! üòä"

–ö–û–ù–¢–ï–ö–°–¢ –î–ò–ê–õ–û–ì–ê:
–ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–ø–∏—Å–∫–∏:
{conversation_history}

–ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –Ω–∞—Å:
"{last_bot_message}"

–ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞:
"{last_client_message}"

–ü–æ—á–µ–º—É –∑–∞–ø—É—â–µ–Ω follow-up:
{follow_up_reason}

–¢–ï–ö–£–©–ê–Ø –°–ò–¢–ê–¶–ò–Ø:
- –ö–∞—Å–∞–Ω–∏–µ: #{touch_number} –∏–∑ 5
- –í—Ä–µ–º—è —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞: {hours_since_last_message} —á–∞—Å–æ–≤
- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è: {current_datetime}

–ò–ù–°–¢–†–£–ö–¶–ò–Ø:
1. –û–ø—Ä–µ–¥–µ–ª–∏ —Ç–æ–Ω –∏ –ø–æ–¥—Ö–æ–¥ –¥–ª—è –∫–∞—Å–∞–Ω–∏—è #{touch_number}
2. –ò—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –ø–µ—Ä–µ–ø–∏—Å–∫–∏
3. –ù–∞–ø–∏—à–∏ –ö–†–ê–¢–ö–û–ï —Å–æ–æ–±—â–µ–Ω–∏–µ (1-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
4. –î–æ–±–∞–≤—å —ç–º–æ–¥–∑–∏ (1-2 —à—Ç—É–∫–∏)
5. –°–¥–µ–ª–∞–π –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é (–≤–æ–ø—Ä–æ—Å –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ)
6. –ù–ï –±—É–¥—å –Ω–∞–≤—è–∑—á–∏–≤—ã–º
7. –ü–æ–∫–∞–∂–∏ —Ü–µ–Ω–Ω–æ—Å—Ç—å –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞

–¢–í–û–ô –û–¢–í–ï–¢ (—Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–ª–∏–µ–Ω—Ç—É):
```

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ—á–µ—Ä–µ–¥–µ–π RabbitMQ

### **–°–æ–∑–¥–∞–Ω–∏–µ –æ—á–µ—Ä–µ–¥–µ–π**

```python
# config/queue.py

import pika

class QueueConfig:
    QUEUES = {
        'incoming_messages': {
            'durable': True,
            'arguments': {
                'x-message-ttl': 86400000,  # 24 —á–∞—Å–∞
                'x-max-length': 10000
            }
        },
        'outgoing_messages': {
            'durable': True,
            'arguments': {
                'x-message-ttl': 3600000,  # 1 —á–∞—Å
                'x-max-length': 5000
            }
        },
        'voice_transcription': {
            'durable': True,
            'arguments': {
                'x-message-ttl': 7200000,  # 2 —á–∞—Å–∞
                'x-max-length': 1000
            }
        }
    }
    
    @staticmethod
    def setup_queues(rabbitmq_url):
        connection = pika.BlockingConnection(
            pika.URLParameters(rabbitmq_url)
        )
        channel = connection.channel()
        
        for queue_name, config in QueueConfig.QUEUES.items():
            channel.queue_declare(
                queue=queue_name,
                durable=config['durable'],
                arguments=config['arguments']
            )
        
        connection.close()
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è**

**–ü–†–û–ï–ö–¢ 1 (WhatsApp Gateway)**:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–≤ –º–∏–Ω—É—Ç—É/—á–∞—Å/–¥–µ–Ω—å)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤—ã—Ö
- –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–µ–π
- –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ Wappi API
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ API

**–ü–†–û–ï–ö–¢ 2 (AI Agent)**:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–π –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö follow-up
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö —Å–æ–∑–≤–æ–Ω–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ Gemini API

### **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

```python
# utils/logger.py

from loguru import logger
import sys

logger.remove()
logger.add(
    sys.stdout,
    format="<green>{time:YYYY-MM-DD HH:mm:ss}</green> | <level>{level: <8}</level> | <cyan>{name}</cyan>:<cyan>{function}</cyan> - <level>{message}</level>",
    level="INFO"
)

logger.add(
    "logs/app_{time:YYYY-MM-DD}.log",
    rotation="00:00",
    retention="30 days",
    level="DEBUG"
)
```

---

## üöÄ Deployment –Ω–∞ Render.com

### **–ü–†–û–ï–ö–¢ 1: WhatsApp Gateway**

**Dockerfile**:
```dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["python", "app.py"]
```

**render.yaml**:
```yaml
services:
  - type: web
    name: whatsapp-gateway
    env: docker
    plan: starter
    region: frankfurt
    healthCheckPath: /health
    envVars:
      - key: WAPPI_TOKEN
        sync: false
      - key: WAPPI_PROFILE_ID
        sync: false
      - key: RABBITMQ_URL
        fromService:
          type: redis
          name: message-queue
          property: connectionString
      - key: DATABASE_URL
        fromDatabase:
          name: gateway-db
          property: connectionString

databases:
  - name: gateway-db
    plan: starter
    databaseName: whatsapp_gateway
```

---

### **–ü–†–û–ï–ö–¢ 2: AI Agent Service**

**Dockerfile**:
```dockerfile
FROM python:3.11-slim

WORKDIR /app

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PDF
RUN apt-get update && apt-get install -y \
    poppler-utils \
    && rm -rf /var/lib/apt/lists/*

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["python", "app.py"]
```

**render.yaml**:
```yaml
services:
  - type: web
    name: ai-agent-service
    env: docker
    plan: starter
    region: frankfurt
    healthCheckPath: /health
    envVars:
      - key: GEMINI_API_KEY
        sync: false
      - key: RABBITMQ_URL
        fromService:
          type: redis
          name: message-queue
          property: connectionString
      - key: DATABASE_URL
        fromDatabase:
          name: ai-agent-db
          property: connectionString

databases:
  - name: ai-agent-db
    plan: starter
    databaseName: ai_agent
```

---

## üéØ –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (4 –Ω–µ–¥–µ–ª–∏)

### **Week 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL –¥–ª—è –æ–±–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ RabbitMQ (–∏–ª–∏ Redis)
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–æ–≤
- [ ] ORM –º–æ–¥–µ–ª–∏ –¥–ª—è –æ–±–µ–∏—Ö –ë–î
- [ ] –ë–∞–∑–æ–≤—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ –∏ utils

### **Week 2: –ü–†–û–ï–ö–¢ 1 - WhatsApp Gateway**
- [ ] Wappi Client (–≤—Å–µ endpoints)
- [ ] Polling Service
- [ ] Sender Service
- [ ] Voice Transcription Service
- [ ] Health Check API
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Wappi

### **Week 3: –ü–†–û–ï–ö–¢ 2 - AI Agent**
- [ ] Gemini Client
- [ ] Message Consumer
- [ ] AI Moderator (–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è)
- [ ] AI Sales Agent
- [ ] Knowledge Base Loader (PDF)
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤

### **Week 4: Advanced Features & Deploy**
- [ ] Follow-up Scheduler
- [ ] –õ–æ–≥–∏–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Å–æ–∑–≤–æ–Ω–æ–≤
- [ ] Timezone handling (Astana)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] Deploy –Ω–∞ Render.com
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ fine-tuning

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –∑–∞–ø—É—Å–∫—É

### **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
- [ ] PostgreSQL –¥–ª—è –ü–†–û–ï–ö–¢ 1 –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] PostgreSQL –¥–ª—è –ü–†–û–ï–ö–¢ 2 –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] RabbitMQ –∏–ª–∏ Redis –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã

### **–ü–†–û–ï–ö–¢ 1**
- [ ] Wappi API —Ç–æ–∫–µ–Ω –∏ profile_id –≤–∞–ª–∏–¥–Ω—ã
- [ ] Polling —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ–ª—É—á–µ–Ω–∏–µ —á–∞—Ç–æ–≤)
- [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Whitelist –∑–∞–≥—Ä—É–∂–µ–Ω –≤ –ë–î
- [ ] –û—á–µ—Ä–µ–¥–∏ –ø—É–±–ª–∏–∫—É—é—Ç/–ø–æ–ª—É—á–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏—è

### **–ü–†–û–ï–ö–¢ 2**
- [ ] Gemini API –∫–ª—é—á –≤–∞–ª–∏–¥–µ–Ω
- [ ] PDF –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –∑–∞–≥—Ä—É–∂–µ–Ω—ã
- [ ] –ü—Ä–æ–º–ø—Ç—ã –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
- [ ] –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Follow-up scheduler –∑–∞–ø—É—â–µ–Ω

### **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
- [ ] –°–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –≤—Å—é —Ü–µ–ø–æ—á–∫—É
- [ ] –ì–æ–ª–æ—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É—é—Ç—Å—è
- [ ] –û—Ç–≤–µ—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ WhatsApp
- [ ] Follow-up —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- [ ] –°–æ–∑–≤–æ–Ω—ã –Ω–∞–∑–Ω–∞—á–∞—é—Ç—Å—è –≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

### **–ü–†–û–ï–ö–¢ 1 Endpoints**

```
GET  /health
GET  /stats
POST /test/send-message
GET  /logs/messages?limit=100
```

### **–ü–†–û–ï–ö–¢ 2 Endpoints**

```
GET  /health
GET  /stats
GET  /contacts?is_client=true
GET  /contacts/{phone}
GET  /messages/{contact_id}
GET  /follow-ups/active
GET  /scheduled-calls?status=scheduled
POST /contacts/{phone}/classify (force reclassify)
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- [ ] –í—Å–µ API –∫–ª—é—á–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] Rate limiting –Ω–∞ endpoints
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
- [ ] Backup –ë–î –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**Whitelist –Ω–æ–º–µ—Ä–∞ (–ù–ï –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å)**:
- +77752837306
- +77018855588
- +77088098009

**–†–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è –¥–ª—è —Å–æ–∑–≤–æ–Ω–æ–≤**:
- –ü–Ω-–ü—Ç: 10:00 - 18:00 (–ê—Å—Ç–∞–Ω–∞, UTC+5)

**Timezone**: Asia/Almaty (UTC+5)

---

## üéì –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

### **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞**:
- –°–ü–ò–ù-–ø—Ä–æ–¥–∞–∂–∏ (Neil Rackham)
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Gemini 2.5 Pro
- Best practices RabbitMQ
- WhatsApp Business API guidelines

### **–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏**:
- Wappi API Docs: https://documenter.getpostman.com/view/10932655/2s8YsnYcU3
- Gemini API: https://ai.google.dev/gemini-api/docs
- RabbitMQ Tutorial: https://www.rabbitmq.com/tutorials

---

**–ö–û–ù–ï–¶ –¢–ï–•–ù–ò–ß–ï–°–ö–û–ì–û –ó–ê–î–ê–ù–ò–Ø**

–ì–æ—Ç–æ–≤ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ! üöÄ